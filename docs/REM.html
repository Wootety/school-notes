<!DOCTYPE html>
    <html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
        <style>
/*--------------------------------------------------------------------------------------------- * Copyright (c) Microsoft Corporation. All rights reserved. * Licensed under the MIT License. See License.txt in the project root for license information. *--------------------------------------------------------------------------------------------*/ body { font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback"; font-size: 14px; padding: 0 12px; line-height: 22px; word-wrap: break-word; } body.scrollBeyondLastLine { margin-bottom: calc(100vh - 22px); } body.showEditorSelection .code-line { position: relative; } body.showEditorSelection .code-active-line:before, body.showEditorSelection .code-line:hover:before { content: ""; display: block; position: absolute; top: 0; left: -12px; height: 100%; } body.showEditorSelection li.code-active-line:before, body.showEditorSelection li.code-line:hover:before { left: -30px; } .vscode-light.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(0, 0, 0, 0.15); } .vscode-light.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(0, 0, 0, 0.40); } .vscode-dark.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(255, 255, 255, 0.4); } .vscode-dark.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(255, 255, 255, 0.60); } .vscode-high-contrast.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(255, 160, 0, 0.7); } .vscode-high-contrast.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(255, 160, 0, 1); } img { max-width: 100%; max-height: 100%; } a { color: #4080D0; text-decoration: none; } a:focus, input:focus, select:focus, textarea:focus { outline: 1px solid -webkit-focus-ring-color; outline-offset: -1px; } hr { border: 0; height: 2px; border-bottom: 2px solid; } h1 { padding-bottom: 0.3em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; } h1, h2, h3 { font-weight: normal; } h1 code, h2 code, h3 code, h4 code, h5 code, h6 code { font-size: inherit; line-height: auto; } a:hover { color: #4080D0; text-decoration: underline; } table { border-collapse: collapse; } table > thead > tr > th { text-align: left; border-bottom: 1px solid; } table > thead > tr > th, table > thead > tr > td, table > tbody > tr > th, table > tbody > tr > td { padding: 5px 10px; } table > tbody > tr + tr > td { border-top: 1px solid; } blockquote { margin: 0 7px 0 5px; padding: 0 16px 0 10px; border-left: 5px solid; } code { font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback"; font-size: 14px; line-height: 19px; } body.wordWrap pre { white-space: pre-wrap; } .mac code { font-size: 12px; line-height: 18px; } code > div { padding: 16px; border-radius: 3px; overflow: auto; } /** Theming */ .vscode-light { color: rgb(30, 30, 30); } .vscode-dark { color: #DDD; } .vscode-high-contrast { color: white; } .vscode-light code { color: #A31515; } .vscode-dark code { color: #D7BA7D; } .vscode-light code > div { background-color: rgba(220, 220, 220, 0.4); } .vscode-dark code > div { background-color: rgba(10, 10, 10, 0.4); } .vscode-high-contrast code > div { background-color: rgb(0, 0, 0); } .vscode-high-contrast h1 { border-color: rgb(0, 0, 0); } .vscode-light table > thead > tr > th { border-color: rgba(0, 0, 0, 0.69); } .vscode-dark table > thead > tr > th { border-color: rgba(255, 255, 255, 0.69); } .vscode-light h1, .vscode-light hr, .vscode-light table > tbody > tr + tr > td { border-color: rgba(0, 0, 0, 0.18); } .vscode-dark h1, .vscode-dark hr, .vscode-dark table > tbody > tr + tr > td { border-color: rgba(255, 255, 255, 0.18); } .vscode-light blockquote, .vscode-dark blockquote { background: rgba(127, 127, 127, 0.1); border-color: rgba(0, 122, 204, 0.5); } .vscode-high-contrast blockquote { background: transparent; border-color: #fff; }
</style>
<style>
/* Tomorrow Theme */ /* http://jmblog.github.com/color-themes-for-google-code-highlightjs */ /* Original theme - https://github.com/chriskempson/tomorrow-theme */ /* Tomorrow Comment */ .hljs-comment, .hljs-quote { color: #8e908c; } /* Tomorrow Red */ .hljs-variable, .hljs-template-variable, .hljs-tag, .hljs-name, .hljs-selector-id, .hljs-selector-class, .hljs-regexp, .hljs-deletion { color: #c82829; } /* Tomorrow Orange */ .hljs-number, .hljs-built_in, .hljs-builtin-name, .hljs-literal, .hljs-type, .hljs-params, .hljs-meta, .hljs-link { color: #f5871f; } /* Tomorrow Yellow */ .hljs-attribute { color: #eab700; } /* Tomorrow Green */ .hljs-string, .hljs-symbol, .hljs-bullet, .hljs-addition { color: #718c00; } /* Tomorrow Blue */ .hljs-title, .hljs-section { color: #4271ae; } /* Tomorrow Purple */ .hljs-keyword, .hljs-selector-tag { color: #8959a8; } .hljs { display: block; overflow-x: auto; color: #4d4d4c; padding: 0.5em; } .hljs-emphasis { font-style: italic; } .hljs-strong { font-weight: bold; }
</style>
<style>
ul.contains-task-list { padding-left: 0; } ul ul.contains-task-list { padding-left: 40px; } .task-list-item { list-style-type: none; } .task-list-item-checkbox { vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'HelveticaNeue-Light', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
    </head>
    <body>
        <!-- markdownlint-disable MD025 MD033 MD024-->
<h1 id="reverse-engineering-malware">Reverse Engineering Malware</h1>
<ul>
<li><a href="#reverse-engineering-malware">Reverse Engineering Malware</a></li>
<li><a href="#chapter-1---basic-concepts">Chapter 1 - Basic Concepts</a>
<ul>
<li><a href="#convert-binary-to-decimal">Convert <strong>Binary</strong> to <strong>Decimal</strong></a></li>
<li><a href="#convert-unsigned-decimal-to-binary">Convert <strong>Unsigned Decimal</strong> to <strong>Binary</strong></a></li>
<li><a href="#binary-addition">Binary Addition</a></li>
<li><a href="#binary-to-hex">Binary to Hex</a></li>
<li><a href="#hex-to-decimal">Hex to Decimal</a></li>
<li><a href="#signed-integers">Signed Integers</a></li>
<li><a href="#twos-complement">Two's Complement</a></li>
<li><a href="#binary-subtraction">Binary Subtraction</a></li>
<li><a href="#boolean-algebra">Boolean Algebra</a>
<ul>
<li><a href="#not">NOT</a></li>
<li><a href="#and">AND</a></li>
<li><a href="#or">OR</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chapter-2---x86-processor-architecture">Chapter 2 - x86 Processor Architecture</a>
<ul>
<li><a href="#general-purpose-registers">General Purpose Registers</a></li>
<li><a href="#accessing-parts-of-a-register">Accessing Parts of a register</a></li>
<li><a href="#specialized-register-uses">Specialized Register Uses</a>
<ul>
<li><a href="#general-purpose">General Purpose</a></li>
<li><a href="#segment">Segment</a></li>
<li><a href="#special">Special</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chapter-3---fundamentals">Chapter 3 - Fundamentals</a>
<ul>
<li><a href="#integer-contstants">Integer Contstants</a></li>
<li><a href="#instruction">Instruction</a>
<ul>
<li><a href="#label">Label</a></li>
<li><a href="#memonic-and-operands">Memonic and Operands</a></li>
<li><a href="#comments">Comments</a></li>
<li><a href="#instruction-format-example">Instruction Format Example</a></li>
</ul>
</li>
<li><a href="#defining-data">Defining Data</a>
<ul>
<li><a href="#data-types">Data Types</a></li>
<li><a href="#data-definition-statement">Data Definition Statement</a></li>
<li><a href="#defining-byte-and-sbyte">Defining BYTE and SBYTE</a></li>
<li><a href="#defining-byte-arrays">Defining Byte Arrays</a></li>
<li><a href="#dup-operator">DUP operator</a></li>
<li><a href="#little-endian-order">Little Endian order</a></li>
<li><a href="#declaring-uninitialized-data">Declaring uninitialized data</a></li>
</ul>
</li>
<li><a href="#symbolic-constants">Symbolic Constants</a>
<ul>
<li><a href="#equals-sign">Equals Sign</a></li>
<li><a href="#calculate-size-of-arrays-and-strings">Calculate Size of Arrays and strings</a>
<ul>
<li><a href="#byte-array">Byte Array</a></li>
<li><a href="#word-array">Word Array</a></li>
<li><a href="#dword-array">DWORD Array</a></li>
</ul>
</li>
<li><a href="#equ-directive">EQU Directive</a></li>
<li><a href="#textequ-directive">TEXTEQU Directive</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chapter-4---data-transfer--addressing-and-arithmetic">Chapter 4 - Data Transfer, Addressing and Arithmetic</a>
<ul>
<li><a href="#data-transfer-instructions">Data Transfer Instructions</a>
<ul>
<li><a href="#operand-types">Operand Types</a></li>
<li><a href="#direct-memory-operands">Direct Memory Operands</a></li>
<li><a href="#mov-instruction">MOV instruction</a></li>
<li><a href="#zero-extension">Zero Extension</a></li>
<li><a href="#sign-extension">Sign Extension</a></li>
<li><a href="#xchg-instruction">XCHG Instruction</a></li>
<li><a href="#direct-offset-operands">Direct-Offset Operands</a></li>
<li><a href="#challenge---program-that-makes-a-array-of-1-2-3-to-3-1-2">Challenge - Program that makes a array of 1,2,3 to 3,1,2</a></li>
</ul>
</li>
<li><a href="#addition-and-subtraction">Addition and Subtraction</a>
<ul>
<li><a href="#inc-and-dec-instructions">INC and DEC Instructions</a></li>
<li><a href="#add-and-sub-operations">ADD and SUB operations</a></li>
<li><a href="#neg-negate-operation">NEG (negate) operation</a></li>
</ul>
</li>
<li><a href="#flags-affected-by-arithmetic">Flags affected by arithmetic</a>
<ul>
<li><a href="#zero-flag-zf">Zero Flag (ZF)</a></li>
<li><a href="#sign-flag-sf">Sign Flag (SF)</a></li>
<li><a href="#hardware-viewpoint-on-signed-and-unsigned">Hardware viewpoint on signed and unsigned</a></li>
<li><a href="#carry-flag-cf">Carry Flag (CF)</a>
<ul>
<li><a href="#too-big">Too Big</a></li>
<li><a href="#too-small">Too Small</a></li>
</ul>
</li>
<li><a href="#sf-zf-cf-demo">SF,ZF,CF Demo</a></li>
<li><a href="#overflow-flag-of">Overflow Flag (OF)</a></li>
</ul>
</li>
<li><a href="#data-related-addressing">Data-related addressing</a>
<ul>
<li><a href="#offset-operator">OFFSET Operator</a></li>
<li><a href="#ptr-operator">PTR Operator</a></li>
<li><a href="#type-operator">TYPE Operator</a></li>
<li><a href="#lengthof-operator">LENGTHOF Operator</a></li>
<li><a href="#sizeof-operator">SIZEOF Operator</a></li>
<li><a href="#spanning-multiple-lines">Spanning Multiple lines</a></li>
<li><a href="#label-directive">LABEL Directive</a></li>
</ul>
</li>
<li><a href="#indirect-addressing">Indirect Addressing</a>
<ul>
<li><a href="#indirect-operands">Indirect Operands</a></li>
<li><a href="#array-sum-example">Array Sum Example</a></li>
<li><a href="#indexed-operands">Indexed Operands</a></li>
</ul>
</li>
<li><a href="#jmp-and-loop-instructions">JMP and LOOP instructions</a>
<ul>
<li><a href="#jmp-instruction">JMP instruction</a></li>
<li><a href="#loop-instruction">LOOP instruction</a></li>
<li><a href="#loop-example">LOOP Example</a></li>
<li><a href="#nested-loop">Nested Loop</a></li>
<li><a href="#summing-integer-array">Summing integer array</a></li>
<li><a href="#copying-a-string">Copying a string</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chapter-5---procedure">Chapter 5 - Procedure</a>
<ul>
<li><a href="#stack-operations">Stack operations</a>
<ul>
<li><a href="#runtime-stack">Runtime stack</a></li>
<li><a href="#push-operation">PUSH Operation</a></li>
<li><a href="#pop-operation">POP Operation</a></li>
<li><a href="#using-push-and-pop">Using PUSH and POP</a></li>
<li><a href="#example---nested-loops">Example - Nested Loops</a></li>
<li><a href="#related-instructions">Related Instructions</a></li>
</ul>
</li>
<li><a href="#defining-and-using-procedures">Defining and using Procedures</a>
<ul>
<li><a href="#creating-procedures">Creating Procedures</a></li>
<li><a href="#documenting-procedues">Documenting Procedues</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#call-and-ret-instructions">CALL and RET instructions</a></li>
<li><a href="#call-ret-example">CALL-RET Example</a></li>
<li><a href="#local-and-global-labels">Local and Global Labels</a></li>
<li><a href="#procedure-parameters">Procedure Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conditional-processing">Conditional Processing</a>
<ul>
<li><a href="#boolean-and-comparison-instructions">Boolean and Comparison Instructions</a>
<ul>
<li><a href="#status-flags-review">Status Flags Review</a></li>
<li><a href="#and-instruction">AND instruction</a></li>
<li><a href="#or-instruction">OR Instruction</a></li>
<li><a href="#xor-instruction">XOR Instruction</a></li>
<li><a href="#not-instruction">NOT Instruction</a></li>
<li><a href="#applications">Applications</a></li>
<li><a href="#test">Test</a></li>
<li><a href="#cmp-instruction">CMP Instruction</a>
<ul>
<li><a href="#destination-source">Destination == Source</a></li>
<li><a href="#destination-source">Destination &lt; Source</a></li>
<li><a href="#destination-source">Destination &gt; Source</a></li>
</ul>
</li>
<li><a href="#comparison-with-signed-integers">Comparison with signed integers</a>
<ul>
<li><a href="#destination-source">Destination &gt; Source</a></li>
<li><a href="#destination-source">Destination &lt; Source</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conditional-jumps">Conditional Jumps</a>
<ul>
<li><a href="#jump-based-on-specific-flags">Jump Based on Specific Flags</a></li>
<li><a href="#jump-based-on-equality">Jump based on Equality</a></li>
<li><a href="#jump-based-on-unsigned-comparisons">Jump based on Unsigned Comparisons</a></li>
<li><a href="#jump-based-on-signed-comparisons">Jump based on Signed comparisons</a></li>
<li><a href="#applications">Applications</a></li>
<li><a href="#encrypting-a-string">Encrypting a string</a></li>
</ul>
</li>
<li><a href="#conditional-loop-instructions">Conditional Loop instructions</a>
<ul>
<li><a href="#loopz-and-loope">LOOPZ and LOOPE</a></li>
<li><a href="#loopnz-and-loopne">LOOPNZ and LOOPNE</a></li>
</ul>
</li>
<li><a href="#conditional-control-flow-drectives">Conditional Control flow Drectives</a>
<ul>
<li><a href="#runtime-expressions">Runtime Expressions</a></li>
<li><a href="#relational-and-logical-operators">Relational and Logical Operators</a></li>
<li><a href="#masm-generated-code">MASM generated code</a></li>
<li><a href="#repeat-directive">.REPEAT directive</a></li>
<li><a href="#while-directive">.WHILE directive</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chapter-7---integer-arithmetic">Chapter 7 - Integer Arithmetic</a>
<ul>
<li><a href="#shift-and-rotate-instructions">Shift and Rotate Instructions</a>
<ul>
<li><a href="#logical-shift">Logical Shift</a></li>
<li><a href="#arthmetic-shift">Arthmetic Shift</a></li>
<li><a href="#shl-instruction">SHL instruction</a></li>
<li><a href="#fast-multiplication">Fast Multiplication</a></li>
<li><a href="#shr-instruction">SHR instruction</a></li>
<li><a href="#sal-and-sar">SAL and SAR</a></li>
<li><a href="#rol-instruction">ROL instruction</a></li>
<li><a href="#ror-instruction">ROR Instruction</a></li>
<li><a href="#rcl-instruction">RCL Instruction</a></li>
<li><a href="#rcr-instruction">RCR Instruction</a></li>
<li><a href="#shld-instruction">SHLD Instruction</a></li>
<li><a href="#shrd-instruction">SHRD Instruction</a></li>
</ul>
</li>
<li><a href="#shift-and-rotate-applications">Shift and Rotate Applications</a></li>
<li><a href="#multiplication-and-division-instructions">Multiplication and division instructions</a>
<ul>
<li><a href="#mul-instruction">MUL Instruction</a></li>
<li><a href="#imul-instruction">IMUL Instruction</a></li>
<li><a href="#div-instruction">DIV Instruction</a></li>
<li><a href="#signed-integer-division-idiv">Signed Integer Division (IDIV)</a></li>
<li><a href="#cbw--cwd--cdq-instruction">CBW, CWD, CDQ Instruction</a></li>
<li><a href="#idiv-instruction">IDIV Instruction</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="chapter-1---basic-concepts">Chapter 1 - Basic Concepts</h1>
<h2 id="convert-binary-to-decimal">Convert <strong>Binary</strong> to <strong>Decimal</strong></h2>
<p>binary 1011 = decimal 11</p>
<table>
<thead>
<tr>
<th style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">2^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></th>
<th style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">2^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></th>
<th style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>1</mn></msup></mrow><annotation encoding="application/x-tex">2^1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></th>
<th style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">2^0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mn>1</mn><mo>=</mo><msup><mn>2</mn><mn>3</mn></msup><mo>+</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><msup><mn>2</mn><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">11 = 2^3 + 2^1 + 2^0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="base"><span class="mord">1</span><span class="mord">1</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="convert-unsigned-decimal-to-binary">Convert <strong>Unsigned Decimal</strong> to <strong>Binary</strong></h2>
<table>
<thead>
<tr>
<th style="text-align:center">Division</th>
<th style="text-align:center">Quotient</th>
<th style="text-align:center">Reminder</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">37 / 2</td>
<td style="text-align:center">18</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">18 / 2</td>
<td style="text-align:center">9</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">9 / 2</td>
<td style="text-align:center">4</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">4/2</td>
<td style="text-align:center">2</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">2/2</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1/2</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p><code>decimal 37 = binary 100101</code></p>
<h2 id="binary-addition">Binary Addition</h2>
<p>Start with <em>least</em> significant bit</p>
<table>
<thead>
<tr>
<th style="text-align:center">2^4</th>
<th style="text-align:center">2^3</th>
<th style="text-align:center">2^2</th>
<th style="text-align:center">2^1</th>
<th style="text-align:center">2^0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mn>1</mn><mn>0</mn><mn>1</mn><mn>0</mn><mo>+</mo><mn>0</mn><mn>1</mn><mn>1</mn><mn>0</mn><mn>0</mn><mo>=</mo><mn>1</mn><mn>0</mn><mn>1</mn><mn>1</mn><mn>0</mn></mrow><annotation encoding="application/x-tex">01010 + 01100 = 10110</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="base"><span class="mord">0</span><span class="mord">1</span><span class="mord">0</span><span class="mord">1</span><span class="mord">0</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mord">0</span></span></span></span></p>
<h2 id="binary-to-hex">Binary to Hex</h2>
<p><strong>Each</strong> <em>Hex</em> digit translates to <strong>4</strong> <em>binary</em> digits</p>
<table>
<thead>
<tr>
<th style="text-align:center">Binary</th>
<th style="text-align:center">Decimal</th>
<th style="text-align:center">Hexadecimal</th>
<th style="text-align:center"></th>
<th style="text-align:center">Binary</th>
<th style="text-align:center">Decimal</th>
<th style="text-align:center">Hexadecimal</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0000</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center"></td>
<td style="text-align:center">1000</td>
<td style="text-align:center">8</td>
<td style="text-align:center">8</td>
</tr>
<tr>
<td style="text-align:center">0001</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center"></td>
<td style="text-align:center">1001</td>
<td style="text-align:center">9</td>
<td style="text-align:center">9</td>
</tr>
<tr>
<td style="text-align:center">0010</td>
<td style="text-align:center">2</td>
<td style="text-align:center">2</td>
<td style="text-align:center"></td>
<td style="text-align:center">1010</td>
<td style="text-align:center">10</td>
<td style="text-align:center">A</td>
</tr>
<tr>
<td style="text-align:center">0011</td>
<td style="text-align:center">3</td>
<td style="text-align:center">3</td>
<td style="text-align:center"></td>
<td style="text-align:center">1011</td>
<td style="text-align:center">11</td>
<td style="text-align:center">B</td>
</tr>
<tr>
<td style="text-align:center">0100</td>
<td style="text-align:center">4</td>
<td style="text-align:center">4</td>
<td style="text-align:center"></td>
<td style="text-align:center">1100</td>
<td style="text-align:center">12</td>
<td style="text-align:center">C</td>
</tr>
<tr>
<td style="text-align:center">0101</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center"></td>
<td style="text-align:center">1101</td>
<td style="text-align:center">13</td>
<td style="text-align:center">D</td>
</tr>
<tr>
<td style="text-align:center">0110</td>
<td style="text-align:center">6</td>
<td style="text-align:center">6</td>
<td style="text-align:center"></td>
<td style="text-align:center">1110</td>
<td style="text-align:center">14</td>
<td style="text-align:center">E</td>
</tr>
<tr>
<td style="text-align:center">0111</td>
<td style="text-align:center">7</td>
<td style="text-align:center">7</td>
<td style="text-align:center"></td>
<td style="text-align:center">1111</td>
<td style="text-align:center">15</td>
<td style="text-align:center">F</td>
</tr>
</tbody>
</table>
<h2 id="hex-to-decimal">Hex to Decimal</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Division</th>
<th style="text-align:center">Quotient</th>
<th style="text-align:center">Reminder</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">422 / 16</td>
<td style="text-align:center">26</td>
<td style="text-align:center">6</td>
</tr>
<tr>
<td style="text-align:center">26 / 16</td>
<td style="text-align:center">1</td>
<td style="text-align:center">A</td>
</tr>
<tr>
<td style="text-align:center">1 / 16</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p><code>decimal 422 = Hex 1A6</code></p>
<h2 id="signed-integers">Signed Integers</h2>
<p><strong>Highest</strong> bit indicates sign. <code>1 = negative, 0 = positive</code></p>
<p>If highest digit of <strong>hex &gt; 7</strong>, value is <strong>negative</strong></p>
<h2 id="twos-complement">Two's Complement</h2>
<p>Negative Numbers stored in two's complement notation</p>
<p>For -1</p>
<table>
<thead>
<tr>
<th style="text-align:left">Instruction</th>
<th style="text-align:center">Binary</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Starting Value</td>
<td style="text-align:center">00000001</td>
</tr>
<tr>
<td style="text-align:left">Reverse Bits</td>
<td style="text-align:center">11111110</td>
</tr>
<tr>
<td style="text-align:left">Plus 1</td>
<td style="text-align:center">11111111</td>
</tr>
</tbody>
</table>
<p><code>-1 is represented as 11111111 in a 1 byte binary</code></p>
<h2 id="binary-subtraction">Binary Subtraction</h2>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>1</mn><mn>1</mn><mn>0</mn><mn>0</mn><mo>−</mo><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>1</mn><mn>1</mn><mo>=</mo><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>1</mn><mn>1</mn><mn>0</mn><mn>0</mn><mo>+</mo><mo>(</mo><mo>−</mo><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>1</mn><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">00001100 - 00000011 = 00001100 + (-00000011)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p>
<table>
<thead>
<tr>
<th style="text-align:left">Instruction</th>
<th style="text-align:center">Binary</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Starting Value</td>
<td style="text-align:center">00000011</td>
</tr>
<tr>
<td style="text-align:left">Reverse Bits</td>
<td style="text-align:center">11111100</td>
</tr>
<tr>
<td style="text-align:left">Plus 1</td>
<td style="text-align:center">11111101</td>
</tr>
</tbody>
</table>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>1</mn><mn>1</mn><mn>0</mn><mn>0</mn><mo>+</mo></mrow><annotation encoding="application/x-tex">00001100 +</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="base"><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">+</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mn>1</mn><mn>1</mn><mn>1</mn><mn>1</mn><mn>1</mn><mn>0</mn><mn>1</mn><mo>=</mo></mrow><annotation encoding="application/x-tex">11111101 =</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base"><span class="mord">1</span><span class="mord">1</span><span class="mord">1</span><span class="mord">1</span><span class="mord">1</span><span class="mord">1</span><span class="mord">0</span><span class="mord">1</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>1</mn><mn>0</mn><mn>0</mn><mn>1</mn></mrow><annotation encoding="application/x-tex">00001001</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base"><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>1</mn><mn>1</mn><mn>0</mn><mn>0</mn><mo>−</mo><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>1</mn><mn>1</mn><mo>=</mo><mn>0</mn><mn>0</mn><mn>0</mn><mn>0</mn><mn>1</mn><mn>0</mn><mn>0</mn><mn>1</mn></mrow><annotation encoding="application/x-tex">00001100 - 00000011 = 00001001</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="base"><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span></span></span></span></p>
<h2 id="boolean-algebra">Boolean Algebra</h2>
<h3 id="not">NOT</h3>
<table>
<thead>
<tr>
<th style="text-align:center">X</th>
<th style="text-align:center">Not X</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:center">T</td>
</tr>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">F</td>
</tr>
</tbody>
</table>
<h3 id="and">AND</h3>
<table>
<thead>
<tr>
<th style="text-align:center">X</th>
<th style="text-align:center">Y</th>
<th style="text-align:center">X AND Y</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:center">F</td>
<td style="text-align:center">F</td>
</tr>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:center">T</td>
<td style="text-align:center">F</td>
</tr>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">F</td>
<td style="text-align:center">F</td>
</tr>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">T</td>
<td style="text-align:center">T</td>
</tr>
</tbody>
</table>
<h3 id="or">OR</h3>
<table>
<thead>
<tr>
<th style="text-align:center">X</th>
<th style="text-align:center">Y</th>
<th style="text-align:center">X AND Y</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:center">F</td>
<td style="text-align:center">F</td>
</tr>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:center">T</td>
<td style="text-align:center">T</td>
</tr>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">F</td>
<td style="text-align:center">T</td>
</tr>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">T</td>
<td style="text-align:center">T</td>
</tr>
</tbody>
</table>
<h1 id="chapter-2---x86-processor-architecture">Chapter 2 - x86 Processor Architecture</h1>
<h2 id="general-purpose-registers">General Purpose Registers</h2>
<p>Storage Locations inside CPU, optimized for speed.</p>
<p>Can store a <strong>DWORD</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">32 Bit General</th>
<th style="text-align:center">Purpose Registers</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">EAX</td>
<td style="text-align:center">EBP</td>
</tr>
<tr>
<td style="text-align:center">EBX</td>
<td style="text-align:center">ESP</td>
</tr>
<tr>
<td style="text-align:center">ECX</td>
<td style="text-align:center">ESI</td>
</tr>
<tr>
<td style="text-align:center">EDX</td>
<td style="text-align:center">EDI</td>
</tr>
</tbody>
</table>
<p>Can store a <strong>WORD</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">16 Bit Segment</th>
<th style="text-align:center">Registers</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CS</td>
<td style="text-align:center">FS</td>
</tr>
<tr>
<td style="text-align:center">DS</td>
<td style="text-align:center">GS</td>
</tr>
<tr>
<td style="text-align:center">ES</td>
<td style="text-align:center">SS</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center">Special Registers</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">EFLAGS</td>
</tr>
<tr>
<td style="text-align:center">EIP</td>
</tr>
</tbody>
</table>
<h2 id="accessing-parts-of-a-register">Accessing Parts of a register</h2>
<p>Use 8 bit, 16 bit or 32 bit name</p>
<p>Each <code>| |</code> space represents 8 bits</p>
<pre><code class="language-demo">32  24  16  8   0   - bit
|   |   |   |   |   - EAX
        |   |   |           - AX
        |   |               - AH
            |   |           - AL
</code></pre>
<p><em><strong>The 16 and 8 Bit registers are accessing the values in the EAX</strong></em></p>
<p>The E in EAX stands for <code>extended</code>, extending the range of the 16 bit registers to 32 bits</p>
<p>EAX, EBX, ECX, EDX have both 16 bit and 8 bit names</p>
<p>EBP, ESP, ESI, EDI only have 16 bit names</p>
<h2 id="specialized-register-uses">Specialized Register Uses</h2>
<h3 id="general-purpose">General Purpose</h3>
<table>
<thead>
<tr>
<th style="text-align:center">Register</th>
<th style="text-align:left">Use</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">E<strong>A</strong>X</td>
<td style="text-align:left"><strong>A</strong>ccumulator</td>
</tr>
<tr>
<td style="text-align:center">E<strong>C</strong>X</td>
<td style="text-align:left">Loop <strong>C</strong>ounter</td>
</tr>
<tr>
<td style="text-align:center">E<strong>SP</strong></td>
<td style="text-align:left"><strong>S</strong>tack Pointer</td>
</tr>
<tr>
<td style="text-align:center">ES<strong>I</strong></td>
<td style="text-align:left">Index Register</td>
</tr>
<tr>
<td style="text-align:center">ED<strong>I</strong></td>
<td style="text-align:left">Index Register</td>
</tr>
<tr>
<td style="text-align:center">EB<strong>P</strong></td>
<td style="text-align:left"><strong>B</strong>ase <strong>P</strong>ointer(Frame Pointer)</td>
</tr>
</tbody>
</table>
<h3 id="segment">Segment</h3>
<table>
<thead>
<tr>
<th style="text-align:center">Register</th>
<th style="text-align:left">Use</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CS</td>
<td style="text-align:left"><strong>C</strong>ode <strong>S</strong>egment</td>
</tr>
<tr>
<td style="text-align:center">DS</td>
<td style="text-align:left"><strong>D</strong>ata <strong>S</strong>egment</td>
</tr>
<tr>
<td style="text-align:center">SS</td>
<td style="text-align:left"><strong>S</strong>tack <strong>S</strong>egment</td>
</tr>
<tr>
<td style="text-align:center">ES</td>
<td style="text-align:left">Additional <strong>S</strong>egment</td>
</tr>
<tr>
<td style="text-align:center">FS</td>
<td style="text-align:left">Additional <strong>S</strong>egment</td>
</tr>
<tr>
<td style="text-align:center">GS</td>
<td style="text-align:left">Additional <strong>S</strong>egment</td>
</tr>
</tbody>
</table>
<h3 id="special">Special</h3>
<table>
<thead>
<tr>
<th style="text-align:center">Register</th>
<th style="text-align:left">Use</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">EIP</td>
<td style="text-align:left">Instruction Pointer</td>
</tr>
<tr>
<td style="text-align:center">EFLAGS</td>
<td style="text-align:left">Status and Control Flag<br>Each Flag is a single <strong>bit</strong></td>
</tr>
</tbody>
</table>
<h1 id="chapter-3---fundamentals">Chapter 3 - Fundamentals</h1>
<h2 id="integer-contstants">Integer Contstants</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Type</th>
<th style="text-align:center">Letter</th>
<th style="text-align:center">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Hex</td>
<td style="text-align:center">h</td>
<td style="text-align:center">6Ah</td>
</tr>
<tr>
<td style="text-align:center">Dec</td>
<td style="text-align:center">d</td>
<td style="text-align:center">88d</td>
</tr>
<tr>
<td style="text-align:center">Dec</td>
<td style="text-align:center">88</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Bin</td>
<td style="text-align:center">b</td>
<td style="text-align:center">001010b</td>
</tr>
</tbody>
</table>
<h2 id="instruction">Instruction</h2>
<p>Instruction Contains</p>
<ul>
<li>Label (Optional)</li>
<li>Memonic (Required)</li>
<li>Operand (Dependent on Memonic)</li>
<li>Comment (Optional)</li>
</ul>
<h3 id="label">Label</h3>
<ul>
<li>Acts as placemarkers
<ul>
<li>Marks offset of code</li>
</ul>
</li>
<li>Follows identifier rules</li>
<li>Data Label
<ul>
<li>Must be Unique</li>
<li>Example - <code>MyArray</code> (No colon after)</li>
</ul>
</li>
<li>Code Label
<ul>
<li>Target of Jump and Loop instruction</li>
<li>Example - <code>L1:</code></li>
</ul>
</li>
</ul>
<h3 id="memonic-and-operands">Memonic and Operands</h3>
<ul>
<li>Instruction Memonics
<ul>
<li>Memory Aid</li>
<li>Examples - <code>MOV, ADD, SUB, MUL, INC, DEC</code></li>
</ul>
</li>
<li>Operand
<ul>
<li>Constant</li>
<li>Constant Expression</li>
<li>Register</li>
<li>Memory (data label)</li>
</ul>
</li>
</ul>
<p><em>Constants and constant expressions are often called <strong>Immediate Values</strong></em></p>
<h3 id="comments">Comments</h3>
<ul>
<li>Explain programs purpose</li>
<li>Single Line comments begin with <code>;</code></li>
<li>Multiline comments begin with COMMENT and a chosen character and ends with the chosen character</li>
</ul>
<h3 id="instruction-format-example">Instruction Format Example</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Example</th>
<th style="text-align:left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">No Operand</td>
<td style="text-align:left"><code>stc ;set carry flag</code></td>
</tr>
<tr>
<td style="text-align:left">One Operand</td>
<td style="text-align:left"><code>inc eax ;increment register</code><br><code>inc myByte ; increment memory</code></td>
</tr>
<tr>
<td style="text-align:left">Two Operand</td>
<td style="text-align:left"><code>add eax, ecx ;register, register</code><br><code>sub myByte, 25 ;memory, constant</code><br></td>
</tr>
</tbody>
</table>
<h2 id="defining-data">Defining Data</h2>
<h3 id="data-types">Data Types</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Unsigned</th>
<th style="text-align:left">Signed</th>
<th style="text-align:left">Definition</th>
<th style="text-align:center">Unsigned Range</th>
<th style="text-align:left">Signed Range</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">BYTE</td>
<td style="text-align:left">SBYTE</td>
<td style="text-align:left">8 bit (un)signed integer</td>
<td style="text-align:center">0 to 255</td>
<td style="text-align:left">-128 to 127</td>
</tr>
<tr>
<td style="text-align:left">WORD</td>
<td style="text-align:left">SWORD</td>
<td style="text-align:left">16 bit (un)signed integer</td>
<td style="text-align:center">0 to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mn>1</mn><mn>6</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{16}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td style="text-align:left">-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mn>1</mn><mn>5</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mn>1</mn><mn>5</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{15}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td style="text-align:left">DWORD</td>
<td style="text-align:left">SDWORD</td>
<td style="text-align:left">32 bit (un)signed integer</td>
<td style="text-align:center">0 to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mn>3</mn><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{32}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td style="text-align:left">-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mn>3</mn><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{31}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mn>3</mn><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{31}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td style="text-align:left">QWORD</td>
<td style="text-align:left"></td>
<td style="text-align:left">64 bit unsigned integer</td>
<td style="text-align:center">0 to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mn>6</mn><mn>4</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{64}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td style="text-align:left">-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mn>6</mn><mn>3</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{63}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mn>6</mn><mn>3</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{63}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td style="text-align:left">TBYTE</td>
<td style="text-align:left"></td>
<td style="text-align:left">80 bit integer</td>
<td style="text-align:center">0 to $2^{80}</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">REAL4</td>
<td style="text-align:left"></td>
<td style="text-align:left">4-byte IEEE short real</td>
<td style="text-align:center"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">REAL8</td>
<td style="text-align:left"></td>
<td style="text-align:left">8-byte IEEE short real</td>
<td style="text-align:center"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">REAL10</td>
<td style="text-align:left"></td>
<td style="text-align:left">10-byte IEEE short real</td>
<td style="text-align:center"></td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h3 id="data-definition-statement">Data Definition Statement</h3>
<ul>
<li>Sets aside storage in memory for a variable</li>
<li>Optionally assign a name(label) to the data</li>
<li>Syntax
<ul>
<li><code>Name Type Initializer</code></li>
<li><code>value1 BYTE 10</code></li>
</ul>
</li>
</ul>
<h3 id="defining-byte-and-sbyte">Defining BYTE and SBYTE</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Code</th>
<th style="text-align:left">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>value1 BYTE 'A'</code></td>
<td style="text-align:left">character constant</td>
</tr>
<tr>
<td style="text-align:left"><code>value2 BYTE 0</code></td>
<td style="text-align:left">smallest unsigned byte</td>
</tr>
<tr>
<td style="text-align:left"><code>value3 BYTE 255</code></td>
<td style="text-align:left">largest unsigned byte</td>
</tr>
<tr>
<td style="text-align:left"><code>value4 SBYTE -128</code></td>
<td style="text-align:left">largest signed byte</td>
</tr>
<tr>
<td style="text-align:left"><code>value5 SBYTE +127</code></td>
<td style="text-align:left">largest signed byte</td>
</tr>
<tr>
<td style="text-align:left"><code>value6 BYTE ?</code></td>
<td style="text-align:left">uninitialized byte</td>
</tr>
</tbody>
</table>
<h3 id="defining-byte-arrays">Defining Byte Arrays</h3>
<pre class="hljs"><code><div>list1 <span class="hljs-built_in">BYTE</span> <span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>
list2 <span class="hljs-built_in">BYTE</span> <span class="hljs-number">00100010b</span>, ?, <span class="hljs-string">'a'</span>, <span class="hljs-number">14h</span>
list3 <span class="hljs-built_in">BYTE</span> <span class="hljs-number">50</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>, <span class="hljs-number">80</span>
      <span class="hljs-built_in">BYTE</span> <span class="hljs-number">90</span>, <span class="hljs-number">100</span>, <span class="hljs-number">110</span>, <span class="hljs-number">120</span>
str1  <span class="hljs-built_in">BYTE</span> <span class="hljs-string">"This is a string"</span>, <span class="hljs-number">0</span>
str2  <span class="hljs-built_in">BYTE</span> <span class="hljs-string">'A'</span>, <span class="hljs-string">'E'</span>, <span class="hljs-string">'I'</span>, <span class="hljs-string">'O'</span>, <span class="hljs-string">'U'</span>
str3  <span class="hljs-built_in">BYTE</span> <span class="hljs-string">'The 0 at the end is a null termination'</span> .
           <span class="hljs-string">'This is a multi line string'</span>
str4 <span class="hljs-built_in">BYTE</span> <span class="hljs-string">'0Dh is carriage return, 0Ah is line feed'</span>, <span class="hljs-number">0Dh</span>, <span class="hljs-number">0Ah</span>,
          <span class="hljs-string">'This causes it to go to new line'</span>
</div></code></pre>
<h3 id="dup-operator">DUP operator</h3>
<p>Use DUP to allocate space for array or string</p>
<p>syntax: <code>count DUP</code></p>
<pre class="hljs"><code><div>var1 <span class="hljs-built_in">BYTE</span> <span class="hljs-number">20</span> DUP(<span class="hljs-number">0</span>) <span class="hljs-comment">;20 bytes, all equal to 0</span>
var2 <span class="hljs-built_in">BYTE</span> <span class="hljs-number">20</span> DUP(?) <span class="hljs-comment">;20 bytes, all uninitialized</span>
var3 <span class="hljs-built_in">BYTE</span> <span class="hljs-number">4</span> DUP(<span class="hljs-string">"Hi"</span>)<span class="hljs-comment">;8 bytes, "HiHiHiHi"</span>
</div></code></pre>
<h3 id="little-endian-order">Little Endian order</h3>
<p>All data types larger than a byte store data in little endian order.
<em>Least Significant Byte</em> Occurs at the first memory address</p>
<p>val1 DWORD = 12345678h</p>
<table>
<thead>
<tr>
<th style="text-align:left">Memory Address</th>
<th style="text-align:left">Data</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0000</td>
<td style="text-align:left">78</td>
</tr>
<tr>
<td style="text-align:left">0001</td>
<td style="text-align:left">56</td>
</tr>
<tr>
<td style="text-align:left">0002</td>
<td style="text-align:left">34</td>
</tr>
<tr>
<td style="text-align:left">0003</td>
<td style="text-align:left">12</td>
</tr>
</tbody>
</table>
<h3 id="declaring-uninitialized-data">Declaring uninitialized data</h3>
<ul>
<li>Use the <code>.data?</code> directive to declare uninitialized data segment</li>
<li>Within the segment, declare variables with &quot;?&quot; initializer
<ul>
<li>Example - <code>smallArray DWORD 10 DUP(?)</code></li>
</ul>
</li>
</ul>
<h2 id="symbolic-constants">Symbolic Constants</h2>
<h3 id="equals-sign">Equals Sign</h3>
<ul>
<li><code>name = expression</code>
<ul>
<li>expression is a 32 bit integer</li>
<li>may be redefined</li>
<li>name is called <code>symbolic constant</code></li>
</ul>
</li>
<li>good programming style to use symbols</li>
</ul>
<pre class="hljs"><code><div>COUNT = <span class="hljs-number">500</span>
...
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>, COUNT
</div></code></pre>
<h3 id="calculate-size-of-arrays-and-strings">Calculate Size of Arrays and strings</h3>
<ul>
<li>Current location counter - $
<ul>
<li>subtract from address of array</li>
<li>difference is no of bytes</li>
</ul>
</li>
</ul>
<h4 id="byte-array">Byte Array</h4>
<pre class="hljs"><code><div>list <span class="hljs-built_in">BYTE</span> <span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>
listSize = ($ - list)      <span class="hljs-comment">; 4</span>
</div></code></pre>
<h4 id="word-array">Word Array</h4>
<pre class="hljs"><code><div>list <span class="hljs-built_in">WORD</span> <span class="hljs-number">1000h</span>, <span class="hljs-number">2000h</span>, <span class="hljs-number">3000h</span>, <span class="hljs-number">4000h</span>
listSize = ($ - list)/<span class="hljs-number">2</span>      <span class="hljs-comment">; 4</span>
</div></code></pre>
<h4 id="dword-array">DWORD Array</h4>
<pre class="hljs"><code><div>list <span class="hljs-built_in">DWORD</span> <span class="hljs-number">1000h</span>, <span class="hljs-number">2000h</span>, <span class="hljs-number">3000h</span>, <span class="hljs-number">4000h</span>
listSize = ($ - list)/<span class="hljs-number">4</span>      <span class="hljs-comment">; 4</span>
</div></code></pre>
<h3 id="equ-directive">EQU Directive</h3>
<p>Define symbol as integer or text expression. <strong>Cannot Be redefined</strong></p>
<p>Will act as if</p>
<pre class="hljs"><code><div>PI <span class="hljs-built_in">EQU</span> &lt;<span class="hljs-number">3.1416</span>&gt;
pressKey <span class="hljs-built_in">EQU</span> &lt;<span class="hljs-string">"Press any key to continue"</span>, <span class="hljs-number">0</span>&gt;
<span class="hljs-meta">.data</span>
prompt <span class="hljs-built_in">BYTE</span> pressKey
</div></code></pre>
<h3 id="textequ-directive">TEXTEQU Directive</h3>
<p>Define symbol as integer or text expression. <strong>Can Be redefined</strong></p>
<p>Called Text Macro</p>
<pre class="hljs"><code><div>continueMessage TEXTEQU &lt;<span class="hljs-string">"Do You wish to continue (Y/N)?"</span>, <span class="hljs-number">0</span>&gt;
rowSize = <span class="hljs-number">5</span>
<span class="hljs-meta">.data</span>
prompt1 <span class="hljs-built_in">BYTE</span> continueMessage
count TEXTEQU %(rowSize * <span class="hljs-number">2</span>) <span class="hljs-comment">;Evaluaets this expression and sets count to 10</span>
setupAL TEXTEQU &lt;<span class="hljs-keyword">mov</span>, <span class="hljs-built_in">al</span>, count&gt;
<span class="hljs-meta">
.code</span>
setupAL <span class="hljs-comment">;generates mov al, 10</span>
</div></code></pre>
<h1 id="chapter-4---data-transfer--addressing-and-arithmetic">Chapter 4 - Data Transfer, Addressing and Arithmetic</h1>
<h2 id="data-transfer-instructions">Data Transfer Instructions</h2>
<h3 id="operand-types">Operand Types</h3>
<ul>
<li>Immediate - constant integer
<ul>
<li>value encoded within instruction</li>
</ul>
</li>
<li>register - name of register
<ul>
<li>register name is converted to a number and encoded within instruction</li>
</ul>
</li>
<li>Memory - Reference to location in memory
<ul>
<li>Memory address is encoded within the instruction, or register holds address of memory location</li>
</ul>
</li>
</ul>
<h3 id="direct-memory-operands">Direct Memory Operands</h3>
<ul>
<li>Direct memory operand is a named reference to storage in memory</li>
<li>Named reference (label) is automatically dereferenced by the assembler</li>
<li><code>[var]</code> is similar to <code>*var</code> in c.</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
var1 <span class="hljs-built_in">BYTE</span> <span class="hljs-number">10h</span>   <span class="hljs-comment">;var1 points to the memory location of the array</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,var1
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,[var1]   <span class="hljs-comment">;Alternate notation</span>
</div></code></pre>
<h3 id="mov-instruction">MOV instruction</h3>
<ul>
<li>Move from source to destination.
<ul>
<li>Syntax - <code>MOV destionation,source</code></li>
</ul>
</li>
<li>No more than 1 memory operand allowed</li>
<li><strong>CS</strong>, <strong>EIP</strong>, <strong>IP</strong> cannot be the destination</li>
<li>No immediate to segment mmoves</li>
</ul>
<p>TODO: Find out whether endianness affects this</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
count <span class="hljs-built_in">BYTE</span> <span class="hljs-number">100</span>
wVal  <span class="hljs-built_in">WORD</span> <span class="hljs-number">2</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bl</span>,count      <span class="hljs-comment">;bl = 100</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,wVal       <span class="hljs-comment">;ax = 2</span>
<span class="hljs-keyword">mov</span> count,<span class="hljs-built_in">al</span>      <span class="hljs-comment">;count = ?</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,wVal       <span class="hljs-comment">;error since wVal bigger than al</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,count      <span class="hljs-comment">;error ?Type mismatch?</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,count     <span class="hljs-comment">;error ?Type mismatch?</span>
</div></code></pre>
<p>More Errors</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
bval  <span class="hljs-built_in">BYTE</span>  <span class="hljs-number">100</span>
bVal2 <span class="hljs-built_in">BYTE</span>  ?
wVal  <span class="hljs-built_in">WORD</span>  <span class="hljs-number">2</span>
dVal  <span class="hljs-built_in">DWORD</span> <span class="hljs-number">5</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ds</span>,<span class="hljs-number">45</span>       <span class="hljs-comment">;move to DS not permitted</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,wVal    <span class="hljs-comment">;size mismatch, esi is 32 bits, wVal is 16 bits</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eip</span>,dVal    <span class="hljs-comment">;eip cannot be destination</span>
<span class="hljs-keyword">mov</span> <span class="hljs-number">25</span>,bVal     <span class="hljs-comment">;immediate value cannot be register</span>
<span class="hljs-keyword">mov</span> bVal2,bVal  <span class="hljs-comment">;memory to memory move not permitted</span>
</div></code></pre>
<h3 id="zero-extension">Zero Extension</h3>
<p>When you copy a <em>smaller</em> value to a larger destination, the <strong>MOVZX</strong> instruction fills the upper half of destination with <em>Zeros</em></p>
<p>Destination <strong>MUST</strong> be a register</p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">bl</span>,<span class="hljs-number">10001111b</span>    <span class="hljs-comment">;8 bits</span>
<span class="hljs-keyword">movzx</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">bl</span>         <span class="hljs-comment">;ax = 0000 0000 1000 1111, upper half filled with 0s</span>
</div></code></pre>
<h3 id="sign-extension">Sign Extension</h3>
<p>The <strong>MOVSX</strong> instruction fills the upper half of the destination with a copy of the souce operand's sign bit</p>
<p>Destination <strong>MUST</strong> be a register</p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">bl</span>,<span class="hljs-number">10001111b</span>    <span class="hljs-comment">;8 bits</span>
<span class="hljs-keyword">movsx</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">bl</span>         <span class="hljs-comment">;ax = 1111 1111 1000 1111, upper half filled with sign bit</span>
</div></code></pre>
<h3 id="xchg-instruction">XCHG Instruction</h3>
<p><strong>XCHG</strong> exchanges the values of 2 operands. At least 1 operand must be register. No Immediate Operands permitted.</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
var1 <span class="hljs-built_in">WORD</span> <span class="hljs-number">1000h</span>
var2 <span class="hljs-built_in">WORD</span> <span class="hljs-number">2000h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">xchg</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">bx</span>      <span class="hljs-comment">;exchange 16-bit regs</span>
<span class="hljs-keyword">xchg</span> <span class="hljs-number">ah</span>,<span class="hljs-built_in">al</span>      <span class="hljs-comment">;exchange 8-bit regs</span>
<span class="hljs-keyword">xchg</span> var1,<span class="hljs-built_in">bx</span>    <span class="hljs-comment">;exchange mem,reg</span>
<span class="hljs-keyword">xchg</span> var1,var2  <span class="hljs-comment">;error: 2 memory operands</span>
</div></code></pre>
<h3 id="direct-offset-operands">Direct-Offset Operands</h3>
<p>constant offset is added to data label to produce an effective address. The address is dereferenced to get value inside its memory location.</p>
<p>Byte example</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
arrayB <span class="hljs-built_in">BYTE</span> <span class="hljs-number">10h</span>, <span class="hljs-number">20h</span>, <span class="hljs-number">30h</span>, <span class="hljs-number">40h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,arrayB+<span class="hljs-number">1</span>   <span class="hljs-comment">;AL = 20h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,[arrayB+<span class="hljs-number">1</span>] <span class="hljs-comment">;Alternate notation.</span>
</div></code></pre>
<p>Word/DWord Example</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
arrayW <span class="hljs-built_in">WORD</span>   <span class="hljs-number">1000h</span>,<span class="hljs-number">2000h</span>,<span class="hljs-number">3000h</span>,<span class="hljs-number">4000h</span>
arrayD <span class="hljs-built_in">DWORD</span>  <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,[arrayW+<span class="hljs-number">2</span>]   <span class="hljs-comment">;ax = 2000h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,[arrayW+<span class="hljs-number">4</span>]   <span class="hljs-comment">;ax = 3000h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,[arrayD+<span class="hljs-number">4</span>]  <span class="hljs-comment">;eax = 2</span>
</div></code></pre>
<h3 id="challenge---program-that-makes-a-array-of-1-2-3-to-3-1-2">Challenge - Program that makes a array of 1,2,3 to 3,1,2</h3>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
arrayD <span class="hljs-built_in">DWORD</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span>  <span class="hljs-built_in">eax</span>,[arrayD]     <span class="hljs-comment">;eax = 1</span>
<span class="hljs-keyword">xchg</span> <span class="hljs-built_in">eax</span>,[arrayD+<span class="hljs-number">4</span>]   <span class="hljs-comment">;eax = 2, arrayD = 1,1,3</span>
<span class="hljs-keyword">xchg</span> <span class="hljs-built_in">eax</span>,[arrayD+<span class="hljs-number">8</span>]   <span class="hljs-comment">;eax = 3, arrayD = 1,1,2</span>
<span class="hljs-keyword">mov</span> [arrayD],<span class="hljs-built_in">eax</span>      <span class="hljs-comment">;arrayD = 3,1,2</span>
</div></code></pre>
<h2 id="addition-and-subtraction">Addition and Subtraction</h2>
<h3 id="inc-and-dec-instructions">INC and DEC Instructions</h3>
<ul>
<li><code>inc destination</code>
<ul>
<li>Logic &lt;-- Destination + 1</li>
</ul>
</li>
<li><code>dec destination</code>
<ul>
<li>Logic &lt;-- Destination - 1</li>
</ul>
</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
myWord  <span class="hljs-built_in">WORD</span>  <span class="hljs-number">1000h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">inc</span> myWord    <span class="hljs-comment">;myWord = 1001h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">00ffh</span>
<span class="hljs-keyword">inc</span> <span class="hljs-built_in">ax</span>        <span class="hljs-comment">;ax = 0100h</span>
</div></code></pre>
<h3 id="add-and-sub-operations">ADD and SUB operations</h3>
<ul>
<li><code>add destionation source</code>
<ul>
<li>Logic &lt;-- destionation + source</li>
</ul>
</li>
<li><code>sub destionation source</code>
<ul>
<li>Logic &lt;-- destionation - source</li>
</ul>
</li>
<li><strong>Same rules as the <code>mov</code> instruction</strong></li>
</ul>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
var1 <span class="hljs-built_in">DWORD</span> <span class="hljs-number">10000h</span>
var2 <span class="hljs-built_in">DWORD</span> <span class="hljs-number">20000h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>, var1   <span class="hljs-comment">;eax = 10000h</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">eax</span>,var2    <span class="hljs-comment">;eax = 30000h</span>
</div></code></pre>
<h3 id="neg-negate-operation">NEG (negate) operation</h3>
<p>Reverses the sign of an operand. Can be register or memory</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
valB <span class="hljs-built_in">BYTE</span> -<span class="hljs-number">1</span>
valW <span class="hljs-built_in">WORD</span> +<span class="hljs-number">32767</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,valB     <span class="hljs-comment">;al = -1</span>
<span class="hljs-keyword">neg</span> <span class="hljs-built_in">al</span>          <span class="hljs-comment">;al = 1</span>
</div></code></pre>
<h2 id="flags-affected-by-arithmetic">Flags affected by arithmetic</h2>
<ul>
<li>ALU has status flags that reflect outcome of arithmetic and bitwise operations based on content of destination operand
<ul>
<li>Zero Flag - When destination = 0</li>
<li>Sign Flag - Destination is negative</li>
<li>Carry Flag - when unsigned value out of range</li>
<li>Overflow Flag - when signed value out of range</li>
</ul>
</li>
<li><code>mov</code> instruction never affects the flags</li>
</ul>
<h3 id="zero-flag-zf">Zero Flag (ZF)</h3>
<p>occurs when result of operation produces zero in destination</p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">cx</span>,<span class="hljs-number">1</span>
<span class="hljs-keyword">sub</span> <span class="hljs-built_in">cx</span>,<span class="hljs-number">1</span>        <span class="hljs-comment">;cx = 0, ZF = 1</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">0FFFFh</span>
<span class="hljs-keyword">inc</span> <span class="hljs-built_in">ax</span>          <span class="hljs-comment">; ax = 0; ZF = 1</span>
<span class="hljs-keyword">inc</span> <span class="hljs-built_in">ax</span>          <span class="hljs-comment">; ax = 1; ZF = 0</span>
</div></code></pre>
<h3 id="sign-flag-sf">Sign Flag (SF)</h3>
<p>set when destination operand is negative. Flag is cleared when destination is positive</p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">cx</span>,<span class="hljs-number">0</span>      <span class="hljs-comment">;cx = 0</span>
<span class="hljs-keyword">dec</span> <span class="hljs-built_in">cx</span>        <span class="hljs-comment">;cx = -1, SF = 1</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">cx</span>,<span class="hljs-number">2</span>      <span class="hljs-comment">;cx = 1, SF = 0</span>
</div></code></pre>
<p><em>Signed flag is <strong>Destionations</strong> highest bit</em></p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">0</span>        <span class="hljs-comment">;al = 0</span>
<span class="hljs-keyword">sub</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">1</span>        <span class="hljs-comment">;al = 1111 1111b, SF = 1</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">2</span>        <span class="hljs-comment">;al = 0000 0001b, SF = 0</span>
</div></code></pre>
<h3 id="hardware-viewpoint-on-signed-and-unsigned">Hardware viewpoint on signed and unsigned</h3>
<p>CPU operations work exactly the same on unsigned and signed operations. <em>It doesnt care whether the value is signed or unsigned</em>. It just sets the appropriate sign flags.</p>
<h3 id="carry-flag-cf">Carry Flag (CF)</h3>
<p>set when results of operation generates unsigned value that is out of range</p>
<h4 id="too-big">Too Big</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">0FFh</span>
<span class="hljs-keyword">inc</span> <span class="hljs-built_in">al</span>          <span class="hljs-comment">;AL = 0, CF = 1</span>
</div></code></pre>
<h4 id="too-small">Too Small</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">0</span>
<span class="hljs-keyword">dec</span> <span class="hljs-built_in">al</span>      <span class="hljs-comment">;AL = FF, CF = 1</span>
</div></code></pre>
<h3 id="sf-zf-cf-demo">SF,ZF,CF Demo</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">00FFh</span>      <span class="hljs-comment">;ax = 00FFh, SF = 0, ZF = 0, CF = 0</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">1</span>          <span class="hljs-comment">;ax = 0100h, SF = 0, ZF = 0, CF = 0</span>
<span class="hljs-keyword">sub</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">1</span>          <span class="hljs-comment">;ax = 00FFh, SF = 0, ZF = 0, CF = 0</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">1</span>          <span class="hljs-comment">;al = 00h,   SF = 0, ZF = 1, CF = 1</span>
<span class="hljs-keyword">mov</span> <span class="hljs-number">bh</span>,<span class="hljs-number">6Ch</span>        <span class="hljs-comment">;bh = 6Ch,   SF = 0, ZF = 0, CF = 0</span>
<span class="hljs-keyword">add</span> <span class="hljs-number">bh</span>,<span class="hljs-number">95h</span>        <span class="hljs-comment">;bh = 01h,   SF = 0, ZF = 0, CF = 1</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">2</span>          <span class="hljs-comment">;al = 2,     SF = 0, ZF = 0, CF = 0</span>
<span class="hljs-keyword">sub</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">3</span>          <span class="hljs-comment">;al = FFh,   SF = 1, ZF = 0, CF = 1</span>
</div></code></pre>
<h3 id="overflow-flag-of">Overflow Flag (OF)</h3>
<p>set when signed result of operation is invalid / out of range</p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">127</span>    <span class="hljs-comment">;al = 127, OF = 0</span>
<span class="hljs-keyword">inc</span> <span class="hljs-built_in">al</span>        <span class="hljs-comment">;al = -128, OF = 1, Harder to read.</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">7Fh</span>    <span class="hljs-comment">;al = 7Fh = 127, OF = 0</span>
<span class="hljs-keyword">inc</span> <span class="hljs-built_in">al</span>        <span class="hljs-comment">;al = 80h = 128, OF = 1</span>
</div></code></pre>
<p>2nd one is easier to check whether negative cause If highest digit of hex &gt; 7, value is negative</p>
<ul>
<li>Overflow flags are only set when
<ul>
<li>2 positive operands are added and their sum is negative</li>
<li>2 negative operands are added and their sum is positive</li>
</ul>
</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">80h</span>      <span class="hljs-comment">;al = 80h, OF = 0</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">92h</span>      <span class="hljs-comment">;al = 12, OF = 1  ;overflow cause al is only 8 bits and result is 9 bits</span>
</div></code></pre>
<h2 id="data-related-addressing">Data-related addressing</h2>
<h3 id="offset-operator">OFFSET Operator</h3>
<p>returns distance in bytes, of a label from beginning of its enclosing statements</p>
<pre class="hljs"><code><div><span class="hljs-comment">;Assume data segment begins at 0040 4000h</span>
<span class="hljs-meta">.data</span>
bVal  <span class="hljs-built_in">BYTE</span>  ?
wVal  <span class="hljs-built_in">WORD</span>  ?
dVal  <span class="hljs-built_in">DWORD</span> ?
dVal2 <span class="hljs-built_in">DWORD</span> ?
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,OFFSET bVal     <span class="hljs-comment">;esi = 0040 4000h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,OFFSET wVal     <span class="hljs-comment">;esi = 0040 4001h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,OFFSET dVal     <span class="hljs-comment">;esi = 0040 4003h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,OFFSET dVal2     <span class="hljs-comment">;esi = 0040 4007h</span>
</div></code></pre>
<p>Value returned by OFFSET is a pointer</p>
<pre class="hljs"><code><div><span class="hljs-keyword">char</span> <span class="hljs-built_in">array</span>[<span class="hljs-number">1000</span>];
<span class="hljs-keyword">char</span> *p = <span class="hljs-built_in">array</span>;
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
array <span class="hljs-built_in">BYTE</span> <span class="hljs-number">1000</span> DUP(?)
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>, OFFSET array
</div></code></pre>
<h3 id="ptr-operator">PTR Operator</h3>
<p>overrides the default type of label(variable). allows you to access part of the variable</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
myDouble <span class="hljs-built_in">DWORD</span> <span class="hljs-number">12345678h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,myDouble           <span class="hljs-comment">;error cause myDouble 32 bits, ax 16 bits</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">WORD</span> <span class="hljs-built_in">PTR</span> myDouble  <span class="hljs-comment">;ax = 5678h cause little endian</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">WORD</span> <span class="hljs-built_in">PTR</span> myDouble,<span class="hljs-number">1234h</span> <span class="hljs-comment">;saves 1234h, myDouble = 12341234h (<span class="hljs-doctag">TODO:</span> PLS CHECK)</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
myDouble <span class="hljs-built_in">DWORD</span> <span class="hljs-number">12345678h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> myDouble        <span class="hljs-comment">;al = 78h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [myDouble+<span class="hljs-number">1</span>]    <span class="hljs-comment">;al = 56h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [myDouble+<span class="hljs-number">2</span>]    <span class="hljs-comment">;al = 34h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">WORD</span> <span class="hljs-built_in">PTR</span> myDouble        <span class="hljs-comment">;ax = 5678h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">WORD</span> <span class="hljs-built_in">PTR</span> [myDouble+<span class="hljs-number">2</span>]    <span class="hljs-comment">;ax = 1234h</span>
</div></code></pre>
<p>PTR can be used to combine elements of smaller data type and move them to larger operand</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
myBytes <span class="hljs-built_in">BYTE</span> <span class="hljs-number">12h</span>,<span class="hljs-number">34h</span>,<span class="hljs-number">56h</span>,<span class="hljs-number">78h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">WORD</span> <span class="hljs-built_in">PTR</span> [myBytes]     <span class="hljs-comment">;ax = 3412h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">WORD</span> <span class="hljs-built_in">PTR</span> [myBytes+<span class="hljs-number">2</span>]   <span class="hljs-comment">;ax = 7856h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> myBytes     <span class="hljs-comment">;eax = 78563412h</span>
</div></code></pre>
<h3 id="type-operator">TYPE Operator</h3>
<p>returns size, in bytes, of a single element of a data declaration</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
var1 <span class="hljs-built_in">BYTE</span>   ?
var2 <span class="hljs-built_in">WORD</span>   ?
var3 <span class="hljs-built_in">DWORD</span>  ?
var4 <span class="hljs-built_in">QWORD</span>  ?
<span class="hljs-meta">
.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>, TYPE var1    <span class="hljs-comment">;eax = 1</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>, TYPE var2    <span class="hljs-comment">;eax = 2</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>, TYPE var3    <span class="hljs-comment">;eax = 4</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>, TYPE var4    <span class="hljs-comment">;eax = 8</span>
</div></code></pre>
<h3 id="lengthof-operator">LENGTHOF Operator</h3>
<p>counts no of elements in a single data declaration</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
                                  <span class="hljs-comment">;LENGTHOF</span>
byte1     <span class="hljs-built_in">BYTE</span>  <span class="hljs-number">10</span>,<span class="hljs-number">20</span>,<span class="hljs-number">30</span>          <span class="hljs-comment">;3</span>
array1    <span class="hljs-built_in">WORD</span>  <span class="hljs-number">30</span> DUP(?),<span class="hljs-number">0</span>,<span class="hljs-number">0</span>     <span class="hljs-comment">;30 + 2 = 32</span>
array2    <span class="hljs-built_in">WORD</span>  <span class="hljs-number">5</span> DUP(<span class="hljs-number">3</span> DUP(?))   <span class="hljs-comment">;3 * 5 = 15</span>
array3    <span class="hljs-built_in">DWORD</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>           <span class="hljs-comment">;4</span>
digitstr  <span class="hljs-built_in">BYTE</span>  <span class="hljs-string">"12345678"</span>,<span class="hljs-number">0</span>      <span class="hljs-comment">;9</span>
<span class="hljs-meta">
.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,LENGTHOF array1           <span class="hljs-comment">;32</span>

</div></code></pre>
<h3 id="sizeof-operator">SIZEOF Operator</h3>
<p>equals to lengthof * type</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
                                  <span class="hljs-comment">;SIZEOF</span>
byte1     <span class="hljs-built_in">BYTE</span>  <span class="hljs-number">10</span>,<span class="hljs-number">20</span>,<span class="hljs-number">30</span>          <span class="hljs-comment">;3</span>
array1    <span class="hljs-built_in">WORD</span>  <span class="hljs-number">30</span> DUP(?),<span class="hljs-number">0</span>,<span class="hljs-number">0</span>     <span class="hljs-comment">;30 + 2 = 32 * 2 = 64</span>
array2    <span class="hljs-built_in">WORD</span>  <span class="hljs-number">5</span> DUP(<span class="hljs-number">3</span> DUP(?))   <span class="hljs-comment">;3 * 5 = 15 * 2 = 30</span>
array3    <span class="hljs-built_in">DWORD</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>           <span class="hljs-comment">;4 * 4 = 16</span>
digitstr  <span class="hljs-built_in">BYTE</span>  <span class="hljs-string">"12345678"</span>,<span class="hljs-number">0</span>      <span class="hljs-comment">;9</span>
<span class="hljs-meta">
.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,SIZEOF array1           <span class="hljs-comment">;32 * 4 = 128</span>
</div></code></pre>
<h3 id="spanning-multiple-lines">Spanning Multiple lines</h3>
<ul>
<li>data declaration can span multiple lines if each line ends with comma</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
array <span class="hljs-built_in">WORD</span>  <span class="hljs-number">10</span>,<span class="hljs-number">20</span>,
            <span class="hljs-number">30</span>,<span class="hljs-number">40</span>,
            <span class="hljs-number">50</span>,<span class="hljs-number">60</span>
<span class="hljs-meta">.code</span>
<span class="hljs-built_in">eax</span>,LENGTHOF array    <span class="hljs-comment">;eax = 6</span>
<span class="hljs-built_in">eax</span>,SIZEOF array      <span class="hljs-comment">;eax = 12</span>
</div></code></pre>
<h3 id="label-directive">LABEL Directive</h3>
<p>TODO: ASK HOW THIS WORKS</p>
<h2 id="indirect-addressing">Indirect Addressing</h2>
<h3 id="indirect-operands">Indirect Operands</h3>
<p>Indirect operand holds the address of a variable, usually an address or string. It can be dereferenced.</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
val1 <span class="hljs-built_in">BYTE</span> <span class="hljs-number">10h</span>,<span class="hljs-number">20h</span>,<span class="hljs-number">30h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,OFFSET val1   <span class="hljs-comment">;stores the address of val1</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,[<span class="hljs-built_in">esi</span>]          <span class="hljs-comment">;al = 10h, dereferences ESI and gets the value out</span>

<span class="hljs-keyword">inc</span> <span class="hljs-built_in">esi</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,[<span class="hljs-built_in">esi</span>]          <span class="hljs-comment">;al = 20h, dereferences ESI and gets the value out</span>

<span class="hljs-keyword">inc</span> <span class="hljs-built_in">esi</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,[<span class="hljs-built_in">esi</span>]          <span class="hljs-comment">;al = 30h, dereferences ESI and gets the value out</span>
</div></code></pre>
<p>Use <code>PTR</code> to clarify the size attribute of memory operand</p>
<p>TODO: ASK ABOUT THIS</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
myCount <span class="hljs-built_in">WORD</span> <span class="hljs-number">0</span>
<span class="hljs-meta">
.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,OFFSET myCount    <span class="hljs-comment">;stores the address of myCount</span>
<span class="hljs-keyword">inc</span> [<span class="hljs-built_in">esi</span>]                 <span class="hljs-comment">;error since inc doesn't know the type of the value underneath</span>
<span class="hljs-keyword">inc</span> <span class="hljs-built_in">WORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">esi</span>]        <span class="hljs-comment">;ok as inc now knows the value underneath</span>
</div></code></pre>
<h3 id="array-sum-example">Array Sum Example</h3>
<p>indirect operands are optimal for traversing arrays.</p>
<p><strong>Note:</strong> <em>Register in brackets must be incremented by a value that matches array type</em></p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
arrayW  <span class="hljs-built_in">WORD</span>  <span class="hljs-number">1000h</span>,<span class="hljs-number">2000h</span>,<span class="hljs-number">3000h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>, OFFSET arrayW        <span class="hljs-comment">;esi stores address of arrayW</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,[<span class="hljs-built_in">esi</span>]                  <span class="hljs-comment">;ax stores 1000h</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">esi</span>,TYPE arrayW           <span class="hljs-comment">;esi now has the address of the next element of arrayW</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">ax</span>,[<span class="hljs-built_in">esi</span>]                  <span class="hljs-comment">;ax = 3000h</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">esi</span>,TYPE arrayW           <span class="hljs-comment">;esi now has the address of the next element of arrayW</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">ax</span>,[<span class="hljs-built_in">esi</span>]                  <span class="hljs-comment">;ax = 6000h</span>
</div></code></pre>
<h3 id="indexed-operands">Indexed Operands</h3>
<p>index operands add a constant to a register to generate an effective address. There are 2 notation forms</p>
<pre class="hljs"><code><div>[label + reg]
label[reg]
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
arrayW  <span class="hljs-built_in">WORD</span>  <span class="hljs-number">1000h</span>,<span class="hljs-number">2000h</span>,<span class="hljs-number">3000h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,<span class="hljs-number">0</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,[arrayW + <span class="hljs-built_in">esi</span>]     <span class="hljs-comment">;ax = 1000h</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">esi</span>,<span class="hljs-number">2</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,array[<span class="hljs-built_in">esi</span>]         <span class="hljs-comment">;ax = 4000h</span>
</div></code></pre>
<h2 id="jmp-and-loop-instructions">JMP and LOOP instructions</h2>
<h3 id="jmp-instruction">JMP instruction</h3>
<ul>
<li>JMP is an unconditional jump to a label that is usually within the same procedure.
<ul>
<li>Syntax - <code>JMP target</code></li>
<li>Logic - EIP &lt;-- Target</li>
</ul>
</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-symbol">top:</span>
  .
  .
  <span class="hljs-keyword">jmp</span> top
</div></code></pre>
<h3 id="loop-instruction">LOOP instruction</h3>
<ul>
<li>Loop creates a counting loop
<ul>
<li>Syntax - <code>LOOP target</code></li>
<li>Logic
<ul>
<li>ECX &lt;-- ECX -1</li>
<li>if ECX !=0, jump to target</li>
</ul>
</li>
<li>Implementation
<ul>
<li>assembler calculates distance(in bytes) between the offset of the following instruction and offset of target label. It is called relative offset.</li>
<li>Relative offset added to EIP.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="loop-example">LOOP Example</h3>
<p>The following loop calculates 1+2+3+4+5</p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-number">0</span>     <span class="hljs-comment">;set value of accumulator to 0</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,<span class="hljs-number">5</span>     <span class="hljs-comment">;set value of counter to 5</span>
<span class="hljs-symbol">
L1:</span>
<span class="hljs-keyword">add</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">ecx</span>   <span class="hljs-comment">;add ecx into eax</span>
<span class="hljs-keyword">loop</span> L1       <span class="hljs-comment">;goes back to L1 after subtracting 1 from ecx</span>
<span class="hljs-comment">;adds 5+4+3+2+1</span>
</div></code></pre>
<h3 id="nested-loop">Nested Loop</h3>
<p>If you need to create loop within a loop, you must save the outer loop's counter's ECX value.</p>
<p>In the following loop, outer loop executes 100 times, inner loop 20 times</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
count <span class="hljs-built_in">DWORD</span> ?     <span class="hljs-comment">;stores the counter for outer loop</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,<span class="hljs-number">100</span>       <span class="hljs-comment">;set the value for the outer loop</span>
<span class="hljs-symbol">L1:</span>
  <span class="hljs-keyword">mov</span> count,<span class="hljs-built_in">ecx</span>   <span class="hljs-comment">;store value of the ecx for outer loop in count</span>
  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,<span class="hljs-number">20</span>      <span class="hljs-comment">;set the inner loop counter</span>
<span class="hljs-symbol">L2:</span>
  .
  .
  <span class="hljs-keyword">loop</span> L2         <span class="hljs-comment">;Loops L2 20 times</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,count     <span class="hljs-comment">;restores the outer loop counter. only runs after L2 has loopedk</span>
<span class="hljs-keyword">loop</span> L1           <span class="hljs-comment">;repeat the outer loop</span>
</div></code></pre>
<h3 id="summing-integer-array">Summing integer array</h3>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
intArray <span class="hljs-built_in">WORD</span> <span class="hljs-number">100h</span>,<span class="hljs-number">200h</span>,<span class="hljs-number">300h</span>,<span class="hljs-number">400</span>
<span class="hljs-meta">.code</span>
                            <span class="hljs-comment">;edi is the destination register</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">edi</span>,OFFSET intArray     <span class="hljs-comment">;stores the pointer to the start of intArray</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,LENGTHOF intArray   <span class="hljs-comment">;stores the no. of elements in intArray in the counter</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">0</span>                    <span class="hljs-comment">;the accumulator</span>
<span class="hljs-symbol">L1:</span>
  <span class="hljs-keyword">add</span> <span class="hljs-built_in">ax</span>,[<span class="hljs-built_in">edi</span>]              <span class="hljs-comment">;adds the value at the address of edi</span>
  <span class="hljs-keyword">add</span> <span class="hljs-built_in">edi</span>,TYPE intArray     <span class="hljs-comment">;incremenst edi by 2 cause WORD</span>
  <span class="hljs-keyword">loop</span> L1                   <span class="hljs-comment">;Goes back to L1 and loops until ecx = 0</span>
</div></code></pre>
<h3 id="copying-a-string">Copying a string</h3>
<p>Copy's string from source to target</p>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
source <span class="hljs-built_in">BYTE</span> <span class="hljs-string">"This is the source string"</span>,<span class="hljs-number">0</span>
target <span class="hljs-built_in">BYTE</span> SIZEOF source DUP(<span class="hljs-number">0</span>)
<span class="hljs-meta">
.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,<span class="hljs-number">0</span>               <span class="hljs-comment">;set the index register to 0</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,SIZEOF source   <span class="hljs-comment">;sets the counter to the size of source</span>
<span class="hljs-symbol">L1:</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,source[<span class="hljs-built_in">esi</span>]      <span class="hljs-comment">;get the char from source</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>[<span class="hljs-built_in">esi</span>],<span class="hljs-built_in">al</span>         <span class="hljs-comment">;store it in the target</span>
<span class="hljs-keyword">inc</span> <span class="hljs-built_in">esi</span>                 <span class="hljs-comment">;go to next character.</span>
                        <span class="hljs-comment">;No need to use add esi,TYPE source` as strings are stored in bytes</span>
<span class="hljs-keyword">loop</span> L1

</div></code></pre>
<h1 id="chapter-5---procedure">Chapter 5 - Procedure</h1>
<h2 id="stack-operations">Stack operations</h2>
<h3 id="runtime-stack">Runtime stack</h3>
<ul>
<li>Is a stack
<ul>
<li>Last in First Out (LIFO)</li>
</ul>
</li>
<li>Managed by CPU using 2 registers
<ul>
<li>Stack Segment(<strong>SS</strong>)</li>
<li>Stack Pointer(<strong>ESP</strong>)</li>
</ul>
</li>
</ul>
<h3 id="push-operation">PUSH Operation</h3>
<ul>
<li>32-bit push operation decrements the <code>stack pointer</code> <strong>by 4</strong> and copies a value into the location pointed by the <code>stack pointer</code></li>
<li>The stack grows downwards. The area below ESP is always available (unless stack has overflowed)</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">Before</th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th style="text-align:left">After</th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Address</td>
<td style="text-align:left">Value</td>
<td style="text-align:left">ESP</td>
<td style="text-align:left"></td>
<td style="text-align:left">Address</td>
<td style="text-align:left">Value</td>
<td style="text-align:left">ESP</td>
</tr>
<tr>
<td style="text-align:left">0000 1000</td>
<td style="text-align:left">6</td>
<td style="text-align:left">&lt;--</td>
<td style="text-align:left"></td>
<td style="text-align:left">0000 1000</td>
<td style="text-align:left">6</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0000 0FFC</td>
<td style="text-align:left">9</td>
<td style="text-align:left">&lt;--</td>
</tr>
</tbody>
</table>
<h3 id="pop-operation">POP Operation</h3>
<ul>
<li>Copies value at <code>stack[ESP]</code> into register or variable</li>
<li>adds <em>n</em> to ESP, where n is either 2 or 4
<ul>
<li>value of <em>n</em> depends on the attribute of the operand receiving the data</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">Before</th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th style="text-align:left">After</th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Address</td>
<td style="text-align:left">Value</td>
<td style="text-align:left">ESP</td>
<td style="text-align:left"></td>
<td style="text-align:left">Address</td>
<td style="text-align:left">Value</td>
<td style="text-align:left">ESP</td>
</tr>
<tr>
<td style="text-align:left">0000 1000</td>
<td style="text-align:left">6</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0000 1000</td>
<td style="text-align:left">6</td>
<td style="text-align:left">&lt;--</td>
</tr>
<tr>
<td style="text-align:left">0000 0FFC</td>
<td style="text-align:left">9</td>
<td style="text-align:left">&lt;--</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h3 id="using-push-and-pop">Using PUSH and POP</h3>
<p>Save and restore registers when they contain important values.</p>
<p><em><strong>Push</strong> and <strong>Pop</strong> instructions occur in opposite order</em></p>
<pre class="hljs"><code><div><span class="hljs-comment">;push the registers into the stack</span>
<span class="hljs-keyword">push</span> <span class="hljs-built_in">esi</span>
<span class="hljs-keyword">push</span> <span class="hljs-built_in">ecx</span>
<span class="hljs-keyword">push</span> <span class="hljs-built_in">ebx</span>

<span class="hljs-comment">;display some stuff</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,OFFSET dWordVal
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,LENGTHOF dWordVal
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ebx</span>,TYPE dWordVal
<span class="hljs-keyword">call</span> dumpmem

<span class="hljs-comment">;restore the registers</span>
<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ebx</span>
<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ecx</span>
<span class="hljs-keyword">pop</span> <span class="hljs-built_in">esi</span>
</div></code></pre>
<h3 id="example---nested-loops">Example - Nested Loops</h3>
<p>When creating nested loop, push the outer loop counter to the stack before entering the inner loop</p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,<span class="hljs-number">100</span>         <span class="hljs-comment">;set the outer loop counter to 100</span>
<span class="hljs-symbol">L1:</span>                 <span class="hljs-comment">;begin the outer loop</span>
<span class="hljs-keyword">push</span> <span class="hljs-built_in">ecx</span>            <span class="hljs-comment">;store the loop counter</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,<span class="hljs-number">20</span>          <span class="hljs-comment">;set the inner loop counter</span>
<span class="hljs-symbol">L2:</span>
.
.

<span class="hljs-keyword">loop</span> L2             <span class="hljs-comment">;repeat the inner loop</span>
<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ecx</span>             <span class="hljs-comment">;restore the value of the outer loop</span>
</div></code></pre>
<h3 id="related-instructions">Related Instructions</h3>
<ul>
<li>PUSHFD and POPFD
<ul>
<li>push and pop EFLAGS register</li>
</ul>
</li>
<li>PUSHAD pushes the 32bit general purpose registers onto the stack</li>
</ul>
<h2 id="defining-and-using-procedures">Defining and using Procedures</h2>
<h3 id="creating-procedures">Creating Procedures</h3>
<ul>
<li>Large problems can be divide to smaller tasks to make them more manageable</li>
<li>ASM equivalent of functions in other languages</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment">;Creates a procedure called sample</span>
sample PROC
.
.
.
<span class="hljs-keyword">ret</span>
sample ENDP
</div></code></pre>
<h3 id="documenting-procedues">Documenting Procedues</h3>
<ul>
<li>A description of all tasks accomplished by the procedure</li>
<li><code>Receives</code> - A list of input parameters; state their usage and requirements</li>
<li><code>Returns</code> - A description of values returned by the procedur</li>
<li><code>Requires</code> - Optional list of requirements called <em>preconditions</em> that must be satisfied before procedure is called</li>
<li><em>If Procedure is called without preconditions satisfied, it will probably not produce expected output</em></li>
</ul>
<h3 id="example">Example</h3>
<pre class="hljs"><code><div><span class="hljs-comment">;-------------------------------------------------------------------------------</span>
SumOf PROC
<span class="hljs-comment">;Calculates and returns the sum of 3 32 bit integers</span>
<span class="hljs-comment">;Receives:  EAX, EBX, ECX , the 3 integers to be added. May be signed or unsigned</span>
<span class="hljs-comment">;Returns:   EAX = sum, and status flags (Carry, Overflow, etc) are changed</span>
<span class="hljs-comment">;Requires:  Nothing</span>
<span class="hljs-comment">;-------------------------------------------------------------------------------</span>
  <span class="hljs-keyword">add</span>  <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">ebx</span>
  <span class="hljs-keyword">add</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">ecx</span>
  <span class="hljs-keyword">ret</span>
SumOf ENDP
</div></code></pre>
<h3 id="call-and-ret-instructions">CALL and RET instructions</h3>
<ul>
<li>Call instruction calls a procedure
<ul>
<li>pushes offset of next index onto the stack</li>
<li>copies address of procedure into the <code>EIP</code>(Instruction Pointer)</li>
</ul>
</li>
<li>The RET instruction returns from a procedure
<ul>
<li>pops top of stack into EIP</li>
</ul>
</li>
</ul>
<h3 id="call-ret-example">CALL-RET Example</h3>
<pre class="hljs"><code><div>main PROC
  <span class="hljs-number">00000020</span> <span class="hljs-keyword">call</span> MySub
  <span class="hljs-comment">;0000 0025 is the offset of the instruction immediately after the call instruction. This is added to the stack</span>
  <span class="hljs-comment">; EIP is set to 0000 0040</span>
  <span class="hljs-number">00000025</span> <span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">ebx</span>
  .
  .
main ENDP

MySub PROC
  <span class="hljs-number">00000040</span> <span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">edx</span>
  .
  .
  <span class="hljs-keyword">ret</span>
  <span class="hljs-comment">;the stack is popped and EIP is now set to 0000 0025</span>
MySub ENDP
</div></code></pre>
<h3 id="local-and-global-labels">Local and Global Labels</h3>
<p>local label is only visible to statements inside the same procedure. A global variable is visible everywhere</p>
<pre class="hljs"><code><div>main PROC
  <span class="hljs-keyword">jmp</span> L2      <span class="hljs-comment">;error since L2 is a local label in another procedure</span>
<span class="hljs-symbol">  L1:</span>:        <span class="hljs-comment">;Global Label</span>
  exit
main ENDP

sub2 PROC
<span class="hljs-symbol">  L2:</span>         <span class="hljs-comment">;local label</span>
  <span class="hljs-keyword">jmp</span> L1      <span class="hljs-comment">;ok since L1 is global label</span>
  <span class="hljs-keyword">ret</span>
sub2 PROC
</div></code></pre>
<h3 id="procedure-parameters">Procedure Parameters</h3>
<ul>
<li>A good procedure might be usable in many different programs</li>
<li>Parameters help make procedures flexible because parameter values can change at runtime</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment">;This procedure calculates the sum of an array</span>
<span class="hljs-comment">;This program references 2 variables - myArray and theSum</span>
ArraySum  PROC
  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,<span class="hljs-number">0</span>                 <span class="hljs-comment">;array index      (ESI is the index register)</span>
  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-number">0</span>                 <span class="hljs-comment">;set the sum to 0 (EAX is the accumulator)</span>
  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,LENGTHOF myArray  <span class="hljs-comment">;set no of elements</span>
<span class="hljs-symbol">
  L1:</span>
  <span class="hljs-keyword">add</span> <span class="hljs-built_in">eax</span>,myArray[<span class="hljs-built_in">esi</span>]      <span class="hljs-comment">;add the value of myArray into the accumulator</span>
  <span class="hljs-keyword">add</span> <span class="hljs-built_in">esi</span>,TYPE myArray      <span class="hljs-comment">;increments the esi value to point to the next element</span>
  <span class="hljs-keyword">loop</span> L1

  <span class="hljs-keyword">mov</span> theSum, <span class="hljs-built_in">eax</span>           <span class="hljs-comment">;stores the sum</span>
  <span class="hljs-keyword">ret</span>
Arraysum ENDP
</div></code></pre>
<h1 id="conditional-processing">Conditional Processing</h1>
<h2 id="boolean-and-comparison-instructions">Boolean and Comparison Instructions</h2>
<h3 id="status-flags-review">Status Flags Review</h3>
<ul>
<li><code>Zero</code> flag is set when the result of an operation equals 0</li>
<li><code>Carry</code> flag is set when result is too large for the destination operand</li>
<li><code>Sign</code> flag is set if the destination operand is negative, and clear if destination is negative</li>
<li><code>Overflow</code> flag is set when an instruction generates invalid sign result</li>
</ul>
<h3 id="and-instruction">AND instruction</h3>
<ul>
<li>Perform a Boolean AND operation between each pair of matching bits in two operands</li>
<li>Syntax
<ul>
<li>AND destination,source</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">X</th>
<th style="text-align:center">Y</th>
<th style="text-align:center">X AND Y</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<h3 id="or-instruction">OR Instruction</h3>
<ul>
<li>Perform a Boolean OR operation between each pair of matching bits in two operands</li>
<li>Syntax
<ul>
<li>OR destination,source</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">X</th>
<th style="text-align:center">Y</th>
<th style="text-align:center">X OR Y</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<h3 id="xor-instruction">XOR Instruction</h3>
<ul>
<li>Perform a Boolean E<strong>x</strong>clusive-OR operation between each pair of matching bits in two operands</li>
<li>Syntax
<ul>
<li>XOR destination,source</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">X</th>
<th style="text-align:center">Y</th>
<th style="text-align:center">X XOR Y</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<p>Useful way to toggle(invert) the bits in an operand</p>
<h3 id="not-instruction">NOT Instruction</h3>
<ul>
<li>Perform a Boolean NOT operation on a single destination operand</li>
<li>Syntax
<ul>
<li>NOT destination,source</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">X</th>
<th style="text-align:center">NOT X</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<h3 id="applications">Applications</h3>
<pre class="hljs"><code><div><span class="hljs-comment">;convert character in AL to upper case</span>
<span class="hljs-comment">;use and instruction to clear bit 5</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-string">'a'</span>
<span class="hljs-keyword">AND</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">11011111b</span>        <span class="hljs-comment">;use AND to clear bit 6</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">;convert binary decimal byte into its equivalent ascii decimal digit</span>
<span class="hljs-comment">;use or instruction to set bits 4 and 5</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">6</span>
<span class="hljs-keyword">or</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">00110000b</span>        <span class="hljs-comment">;use or to clear bit 6</span>
</div></code></pre>
<h3 id="test">Test</h3>
<ul>
<li>Performs a non-destructive AND Operation between each pair of matching bits in two operands</li>
<li>No Operands are modified, but <code>Zero</code> flag is modified</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment">;This program jumps to label if either bit 0 or bit 1 in al is set</span>
<span class="hljs-keyword">test</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">00000011b</span>     <span class="hljs-comment">;AND al,0000 0011b</span>
<span class="hljs-keyword">jnz</span> ValueFound        <span class="hljs-comment">;JNZ will be taught later on(Conditional Jumps) jnz = jump not zero</span>
</div></code></pre>
<h3 id="cmp-instruction">CMP Instruction</h3>
<ul>
<li>Compares destination operand to the source operand
<ul>
<li>Non destructive subtraction of source from destionation (destination operand is not changed)</li>
</ul>
</li>
<li>Syntax: <code>cmp destionation,source</code></li>
</ul>
<h4 id="destination-source">Destination == Source</h4>
<p><strong>Zero flag</strong> is <em>set</em></p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">5</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">5</span>          <span class="hljs-comment">;zero flag *set*</span>
</div></code></pre>
<h4 id="destination-source">Destination &lt; Source</h4>
<p><strong>Carry flag</strong> is <em>set</em></p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">4</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">5</span>          <span class="hljs-comment">;carry flag *set*</span>
</div></code></pre>
<h4 id="destination-source">Destination &gt; Source</h4>
<p><strong>Zero and Carry flag</strong> is <em>clear</em></p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">6</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">5</span>          <span class="hljs-comment">;ZF = 0, CF = 0</span>
</div></code></pre>
<h3 id="comparison-with-signed-integers">Comparison with signed integers</h3>
<h4 id="destination-source">Destination &gt; Source</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">5</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">al</span>,-<span class="hljs-number">2</span>         <span class="hljs-comment">;Sign flag == Overflow flag</span>
</div></code></pre>
<h4 id="destination-source">Destination &lt; Source</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,-<span class="hljs-number">1</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">5</span>         <span class="hljs-comment">;Sign flag != Overflow flag</span>
</div></code></pre>
<h2 id="conditional-jumps">Conditional Jumps</h2>
<p>J<strong>cond</strong> - A conditional jump instruction branches to a label when specific register or flag condition are met</p>
<h3 id="jump-based-on-specific-flags">Jump Based on Specific Flags</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Memonic</th>
<th style="text-align:left">Description</th>
<th style="text-align:center">Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">JZ</td>
<td style="text-align:left">Jump if Zero</td>
<td style="text-align:center">ZF = 1</td>
</tr>
<tr>
<td style="text-align:left">JNZ</td>
<td style="text-align:left">Jump if Not Zero</td>
<td style="text-align:center">ZF = 0</td>
</tr>
<tr>
<td style="text-align:left">JC</td>
<td style="text-align:left">Jump if Carry</td>
<td style="text-align:center">CF = 1</td>
</tr>
<tr>
<td style="text-align:left">JNC</td>
<td style="text-align:left">Jump if Not Carry</td>
<td style="text-align:center">CF = 0</td>
</tr>
<tr>
<td style="text-align:left">JO</td>
<td style="text-align:left">Jump if Overflow</td>
<td style="text-align:center">OF = 1</td>
</tr>
<tr>
<td style="text-align:left">JNO</td>
<td style="text-align:left">Jump if Not Overflow</td>
<td style="text-align:center">OF = 0</td>
</tr>
<tr>
<td style="text-align:left">JS</td>
<td style="text-align:left">Jump if Signed</td>
<td style="text-align:center">SF = 1</td>
</tr>
<tr>
<td style="text-align:left">JNS</td>
<td style="text-align:left">Jump if Not Signed</td>
<td style="text-align:center">SF = 0</td>
</tr>
<tr>
<td style="text-align:left">JP</td>
<td style="text-align:left">Jump if Parity(even)</td>
<td style="text-align:center">PF = 1</td>
</tr>
<tr>
<td style="text-align:left">JNP</td>
<td style="text-align:left">Jump if Not Parity(odd)</td>
<td style="text-align:center">PF = 0</td>
</tr>
</tbody>
</table>
<h3 id="jump-based-on-equality">Jump based on Equality</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Memonic</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">JE</td>
<td style="text-align:left">Jump if Equal (leftOp = rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JNE</td>
<td style="text-align:left">Jump if Not Equal (leftOp != rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JCXZ</td>
<td style="text-align:left">Jump if CX = 0</td>
</tr>
<tr>
<td style="text-align:left">JCXZ</td>
<td style="text-align:left">Jump if ECX = 0</td>
</tr>
</tbody>
</table>
<h3 id="jump-based-on-unsigned-comparisons">Jump based on Unsigned Comparisons</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Memonic</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">JA</td>
<td style="text-align:left">Jump if above(if leftOp &gt; rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JNBE</td>
<td style="text-align:left">Jump if not below or equal(Same as JA)</td>
</tr>
<tr>
<td style="text-align:left">JAE</td>
<td style="text-align:left">Jump if above or equal(leftOp &gt;= rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JNB</td>
<td style="text-align:left">Jump if not below (Same as JAE)</td>
</tr>
<tr>
<td style="text-align:left">JB</td>
<td style="text-align:left">Jump if below(leftOp &lt; rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JNAE</td>
<td style="text-align:left">Jump if not above or equal(Same as JB)</td>
</tr>
<tr>
<td style="text-align:left">JBE</td>
<td style="text-align:left">Jump if below or equal(leftOp &lt;= rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JNA</td>
<td style="text-align:left">Jump if not above(Same as JBE)</td>
</tr>
</tbody>
</table>
<h3 id="jump-based-on-signed-comparisons">Jump based on Signed comparisons</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Memonic</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">JG</td>
<td style="text-align:left">Jump if greater(if leftOp &gt; rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JNLE</td>
<td style="text-align:left">Jump if not less or equal(Same as JA)</td>
</tr>
<tr>
<td style="text-align:left">JGE</td>
<td style="text-align:left">Jump if greater or equal(leftOp &gt;= rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JNL</td>
<td style="text-align:left">Jump if not less (Same as JAE)</td>
</tr>
<tr>
<td style="text-align:left">JL</td>
<td style="text-align:left">Jump if less(leftOp &lt; rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JNGE</td>
<td style="text-align:left">Jump if not greater or equal(Same as JB)</td>
</tr>
<tr>
<td style="text-align:left">JLE</td>
<td style="text-align:left">Jump if less or equal(leftOp &lt;= rightOp)</td>
</tr>
<tr>
<td style="text-align:left">JNG</td>
<td style="text-align:left">Jump if not greater(Same as JBE)</td>
</tr>
</tbody>
</table>
<h3 id="applications">Applications</h3>
<pre class="hljs"><code><div><span class="hljs-comment">;Jump to label if unsigned EAX is greater than EBX</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">ebx</span>
<span class="hljs-keyword">ja</span> larger
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">;Jump to label if signed EAX is greater than EBX</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">ebx</span>
<span class="hljs-keyword">jg</span> greater
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">;Jump to label if unsigned EAX is lesser than or equal to EBX</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">ebx</span>
<span class="hljs-keyword">jbe</span> L1
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">;Jump to label if signed EAX is lesser than or equal to EBX</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">ebx</span>
<span class="hljs-keyword">jg</span> greater
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">;Compare unsigned AX and BX, and copy the larger to variable named large</span>
<span class="hljs-keyword">mov</span> large,<span class="hljs-built_in">ax</span>       <span class="hljs-comment">;large = ax</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">bx</span>          <span class="hljs-comment">;compare ax,bx</span>
<span class="hljs-keyword">jnb</span> L1             <span class="hljs-comment">;jump to L1 if ax is not below bx (ax &gt; bx)</span>
<span class="hljs-keyword">mov</span> large,<span class="hljs-built_in">bx</span>       <span class="hljs-comment">;move large = bx if bx is greater than ax</span>
<span class="hljs-symbol">L1:</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">;Compare signed AX and BX, and copy the smaller to variable named small</span>
<span class="hljs-keyword">mov</span> small,<span class="hljs-built_in">ax</span>     <span class="hljs-comment">;small = =ax</span>
<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">bx</span>        <span class="hljs-comment">;compare ax and bx</span>
<span class="hljs-keyword">jng</span> L1           <span class="hljs-comment">;jump to L1 if ax is not greater than bx (ax &lt;= bx)</span>
<span class="hljs-keyword">mov</span> large,<span class="hljs-built_in">bx</span>
<span class="hljs-symbol">L1:</span>
</div></code></pre>
<h3 id="encrypting-a-string">Encrypting a string</h3>
<pre class="hljs"><code><div><span class="hljs-comment">;The following loop uses  the XOR instruction to transform </span>
<span class="hljs-comment">;every character in a string to a new value </span>

KEY = <span class="hljs-number">239</span>
BUFMAX = <span class="hljs-number">128</span>
<span class="hljs-meta">
.data</span>
buffer  <span class="hljs-built_in">BYTE</span>  BUFMAX+<span class="hljs-number">1</span> DUP(<span class="hljs-number">0</span>)
bufSize <span class="hljs-built_in">DWORD</span> BUFMAX
<span class="hljs-meta">
.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,bufSize           <span class="hljs-comment">;loop counter to buffer size</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">esi</span>,<span class="hljs-number">0</span>                 <span class="hljs-comment">;set index register to 0</span>
<span class="hljs-symbol">
L1:</span>
  <span class="hljs-keyword">xor</span> buffer[<span class="hljs-built_in">esi</span>],KEY     <span class="hljs-comment">;translate a byte of data with key</span>
  <span class="hljs-keyword">inc</span> <span class="hljs-built_in">esi</span>                 <span class="hljs-comment">;esi now points to next byte</span>
  <span class="hljs-keyword">loop</span> L1
</div></code></pre>
<h2 id="conditional-loop-instructions">Conditional Loop instructions</h2>
<h3 id="loopz-and-loope">LOOPZ and LOOPE</h3>
<ul>
<li>Synax
<ul>
<li>LOOPE destination</li>
<li>LOOPZ destination</li>
</ul>
</li>
<li>LOOPZ(loop if <em>zero</em>)   instruction works just like the loop instruction except it has 1 more condition. Zero flag must be set</li>
<li>LOOPE(loop if <em>equal</em>)  instruction is equivalent to LOOPZ (cmp sets Zero flag when both values are equal)</li>
<li>Logic:
<ul>
<li>ECX &lt;-- ECX - 1</li>
<li>If ECX &gt; 0 and ZF = 1, jump to destination</li>
</ul>
</li>
<li>Useful for scanning an array for the first element that does not match a given value</li>
</ul>
<h3 id="loopnz-and-loopne">LOOPNZ and LOOPNE</h3>
<ul>
<li>Syntax
<ul>
<li>LOOPNZ destination</li>
<li>LOOPNE destination</li>
</ul>
</li>
<li>Logic:
<ul>
<li>ECX &lt;-- ECX - 1</li>
<li>If ECX &gt; 0 and ZF = 0, jump to destination</li>
</ul>
</li>
<li>Useful when scanning an array for the first element that matches a given value</li>
</ul>
<h2 id="conditional-control-flow-drectives">Conditional Control flow Drectives</h2>
<p>Creating <strong>IF</strong> statements</p>
<h3 id="runtime-expressions">Runtime Expressions</h3>
<p><code>.IF</code>, <code>.ELSE</code>, <code>.ELSEIF</code>, and <code>.ENDIF</code> can be used to evaluate runtime expressions and create block-structured IF statements</p>
<pre class="hljs"><code><div><span class="hljs-meta">.IF</span> <span class="hljs-built_in">eax</span> &gt; <span class="hljs-built_in">ebx</span>
  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">edx</span>,<span class="hljs-number">1</span>
<span class="hljs-meta">.ELSE</span>
  move <span class="hljs-built_in">edx</span>,<span class="hljs-number">2</span>
<span class="hljs-meta">.ENDIF</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-meta">.IF</span> <span class="hljs-built_in">eax</span> &gt; <span class="hljs-built_in">ebx</span> &amp;&amp; <span class="hljs-built_in">eax</span> &gt; <span class="hljs-built_in">ecx</span>
  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">edx</span>,<span class="hljs-number">1</span>
<span class="hljs-meta">.ELSE</span>
  move <span class="hljs-built_in">edx</span>,<span class="hljs-number">2</span>
<span class="hljs-meta">.ENDIF</span>
</div></code></pre>
<p>MASM generates hidden code for you, consisting of code labels, CMP and conditional jumps</p>
<h3 id="relational-and-logical-operators">Relational and Logical Operators</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Operator</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">expr1 == expr2</td>
<td style="text-align:left">true when 1 equal 2</td>
</tr>
<tr>
<td style="text-align:left">expr1 != expr2</td>
<td style="text-align:left">true when 1 not equal 2</td>
</tr>
<tr>
<td style="text-align:left">expr1 &gt; or &lt; expr2</td>
<td style="text-align:left">true when 1 greater / lesser than than 2</td>
</tr>
<tr>
<td style="text-align:left">expr1 &gt;= or &lt;= expr2</td>
<td style="text-align:left">true when 1 greater / lesser than than or equal 2</td>
</tr>
<tr>
<td style="text-align:left">!expr1</td>
<td style="text-align:left">true when expr1 equals false</td>
</tr>
<tr>
<td style="text-align:left">expr1 &amp;&amp; expr2</td>
<td style="text-align:left">logical AND on 1 and 2</td>
</tr>
<tr>
<td style="text-align:left">expr1 || expr2</td>
<td style="text-align:left">logical OR between 1 and 2</td>
</tr>
<tr>
<td style="text-align:left">expr1 &amp; expr2</td>
<td style="text-align:left">bitwise AND between 1 and 2</td>
</tr>
<tr>
<td style="text-align:left">CARRY?</td>
<td style="text-align:left">true if carry flag set</td>
</tr>
<tr>
<td style="text-align:left">OVERFLOW?</td>
<td style="text-align:left">true if overflow flag set</td>
</tr>
<tr>
<td style="text-align:left">PARITY?</td>
<td style="text-align:left">true if parity flag set</td>
</tr>
<tr>
<td style="text-align:left">SIGN?</td>
<td style="text-align:left">true if sign flag set</td>
</tr>
<tr>
<td style="text-align:left">ZERO?</td>
<td style="text-align:left">true if zero flag set</td>
</tr>
</tbody>
</table>
<h3 id="masm-generated-code">MASM generated code</h3>
<ul>
<li>when <em>unsigned</em> values are compared, MASM automatically generates unsigned jump (.IF register &gt; val(where val is unsigned (WORD))</li>
<li>when <em>signed</em> values are compared, MASM automatically generates a signed jump (.IF register &gt; val(where val is signed (SWORD))</li>
</ul>
<h3 id="repeat-directive">.REPEAT directive</h3>
<p>Execute the loop body before testing the loop condition associated with the <code>.UNTIL</code> directive</p>
<pre class="hljs"><code><div><span class="hljs-comment">;display integers from 1-10:</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-number">0</span>
<span class="hljs-meta">.REPEAT</span>
  <span class="hljs-keyword">inc</span> <span class="hljs-built_in">eax</span>
  <span class="hljs-keyword">call</span> WriteDec
  <span class="hljs-keyword">call</span> Crlf
<span class="hljs-meta">.UNTIL</span> <span class="hljs-built_in">eax</span> == <span class="hljs-number">10</span>
</div></code></pre>
<h3 id="while-directive">.WHILE directive</h3>
<p>Tests the loop condition before executing the loop body. The <code>ENDW</code> directive marks the end of the loop</p>
<pre class="hljs"><code><div><span class="hljs-comment">;display integers from 1-10:</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-number">0</span>
<span class="hljs-meta">.WHILE</span> <span class="hljs-built_in">eax</span> &lt; <span class="hljs-number">10</span>
  <span class="hljs-keyword">inc</span> <span class="hljs-built_in">eax</span>
  <span class="hljs-keyword">call</span> WriteDec
  <span class="hljs-keyword">call</span> Crlf
<span class="hljs-meta">.ENDW</span>
</div></code></pre>
<h1 id="chapter-7---integer-arithmetic">Chapter 7 - Integer Arithmetic</h1>
<h2 id="shift-and-rotate-instructions">Shift and Rotate Instructions</h2>
<h3 id="logical-shift">Logical Shift</h3>
<p>From <code>11001111</code>, shifted right and the newly created bit is 0. <code>01100111</code> shifted bit is moved into carry flag</p>
<h3 id="arthmetic-shift">Arthmetic Shift</h3>
<p>From <code>11001111</code>, shifted right and newly created bit is the copy of sign bit. <code>11100111</code> and shifted bit is moved into carry flag</p>
<h3 id="shl-instruction">SHL instruction</h3>
<p>performs logical left shift on destination operand, filling lowest bit with 0 <code>11001111</code> to <code>10011110</code> and the shifted bit is moved into CF</p>
<h3 id="fast-multiplication">Fast Multiplication</h3>
<p>Shifting left by 1 multiplies the number by 2</p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">dl</span>, <span class="hljs-number">5</span>   <span class="hljs-comment">;dl = 00000101 = 5</span>
<span class="hljs-keyword">shl</span> <span class="hljs-built_in">dl</span>, <span class="hljs-number">1</span>   <span class="hljs-comment">;dl = 00001010 = 10</span>
</div></code></pre>
<p>Shifting left by n bits multiplies the operand by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.664392em;"></span><span class="strut bottom" style="height:0.664392em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span></span></span></span></span></span></span></span></p>
<pre class="hljs"><code><div><span class="hljs-comment">; 5 * 2^2</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dl</span>,<span class="hljs-number">5</span>    <span class="hljs-comment">;dl = 0000101 = 5</span>
<span class="hljs-keyword">shl</span> <span class="hljs-built_in">dl</span>,<span class="hljs-number">2</span>    <span class="hljs-comment">;dl = 0010100 = 20</span>
</div></code></pre>
<h3 id="shr-instruction">SHR instruction</h3>
<p>performs logical right shift on destination operand</p>
<p>highest bit position is filled with a zero</p>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">dl</span>,<span class="hljs-number">80</span>       <span class="hljs-comment">;dl = 0101 0000 = 80</span>
<span class="hljs-keyword">shr</span> <span class="hljs-built_in">dl</span>,<span class="hljs-number">1</span>        <span class="hljs-comment">;dl = 0010 1000 = 40</span>
<span class="hljs-keyword">shr</span> <span class="hljs-built_in">dl</span>,<span class="hljs-number">2</span>        <span class="hljs-comment">;dl = 0000 1010 = 10</span>
</div></code></pre>
<h3 id="sal-and-sar">SAL and SAR</h3>
<ul>
<li>SAL (<strong>S</strong>hift <strong>A</strong>rithmetic <strong>L</strong>eft) is identical to SHL</li>
<li>SAR (<strong>S</strong>hift <strong>A</strong>rithmetic <strong>R</strong>ight) performs right arithmetic shift on desination operand</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment">;arithmetic shift preserves the number's sign</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dl</span>,-<span class="hljs-number">80</span>      <span class="hljs-comment">;DL = -80</span>
<span class="hljs-keyword">sar</span> <span class="hljs-built_in">dl</span>,<span class="hljs-number">1</span>        <span class="hljs-comment">;dl = -40</span>
<span class="hljs-keyword">sar</span> <span class="hljs-built_in">dl</span>,<span class="hljs-number">2</span>        <span class="hljs-comment">;dl = -10</span>
</div></code></pre>
<h3 id="rol-instruction">ROL instruction</h3>
<ul>
<li>ROL(rotate left) shifts each bit to the left</li>
<li>Highest bit is compied into both carry flag and lowest bit</li>
<li>No Bits lost</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">11110000b</span>      <span class="hljs-comment">;al = 11110000b</span>
rot <span class="hljs-built_in">al</span>,<span class="hljs-number">1</span>              <span class="hljs-comment">;al = 11100001b</span>
rot <span class="hljs-built_in">al</span>,<span class="hljs-number">4</span>              <span class="hljs-comment">;al = 00011110b</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dl</span>,<span class="hljs-number">3Fh</span>            <span class="hljs-comment">;dl = 3Fh</span>
rot <span class="hljs-built_in">dl</span>,<span class="hljs-number">4</span>              <span class="hljs-comment">;dl = F3h</span>
</div></code></pre>
<h3 id="ror-instruction">ROR Instruction</h3>
<ul>
<li>ROR (rotate right) shifts each bit to the right</li>
<li>lowest bit copied to both carry flag and highest bit</li>
<li>No bits lost</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">11110000b</span>      <span class="hljs-comment">;al = 11110000b</span>
<span class="hljs-keyword">ror</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">1</span>              <span class="hljs-comment">;al = 01111000b</span>
<span class="hljs-keyword">ror</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">4</span>              <span class="hljs-comment">;al = 10000111b</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dl</span> <span class="hljs-number">3Fh</span>            <span class="hljs-comment">;dl = 3Fh</span>
<span class="hljs-keyword">ror</span> <span class="hljs-built_in">dl</span>,<span class="hljs-number">4</span>              <span class="hljs-comment">;dl = F3h</span>
</div></code></pre>
<h3 id="rcl-instruction">RCL Instruction</h3>
<ul>
<li>RCL (rotate carry left) shifts each bit to the left</li>
<li>Copies the carry flag to least significant bit</li>
<li>Copies most significant bit to carry flag</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">clc</span>           <span class="hljs-comment">;CF = 0; clear carry flag</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bl</span>,<span class="hljs-number">88h</span>    <span class="hljs-comment">;CF,BL = 0, 10001000b</span>
<span class="hljs-keyword">rcl</span> <span class="hljs-built_in">bl</span>,<span class="hljs-number">1</span>      <span class="hljs-comment">;CF,BL = 1, 00010000b</span>
<span class="hljs-keyword">rcl</span> <span class="hljs-built_in">bl</span>,<span class="hljs-number">1</span>      <span class="hljs-comment">;CF,BL = 0, 00100001b</span>
</div></code></pre>
<h3 id="rcr-instruction">RCR Instruction</h3>
<ul>
<li>RCR (rotate carry right) shifts each bit to the right</li>
<li>Copies the carry flag to the most significant bit</li>
<li>Copies least significant bit to carry flag</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">stc</span>           <span class="hljs-comment">;CF = 1; set carry flag</span>
<span class="hljs-keyword">mov</span> <span class="hljs-number">ah</span>,<span class="hljs-number">10h</span>    <span class="hljs-comment">;CF,AH = 1 00010000b</span>
<span class="hljs-keyword">rcr</span> <span class="hljs-number">ah</span>,<span class="hljs-number">1</span>      <span class="hljs-comment">;CF,AH = 0 10001000b</span>
</div></code></pre>
<h3 id="shld-instruction">SHLD Instruction</h3>
<ul>
<li>Shift destination operand a given no. of bits to the left</li>
<li>Bit positions opened up by sihft are filled by most significant bit of source operand</li>
<li>Source operand is not affected</li>
<li>Syntax
<ul>
<li><code>SHLD destionation, source, count</code></li>
</ul>
</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">11100000b</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bl</span>,<span class="hljs-number">10011101b</span>
<span class="hljs-keyword">shld</span> <span class="hljs-built_in">al</span>,<span class="hljs-built_in">bl</span>,<span class="hljs-number">1</span>        <span class="hljs-comment">;CF,al = 1 11000001b</span>
</div></code></pre>
<h3 id="shrd-instruction">SHRD Instruction</h3>
<ul>
<li>Shift destination operand a given no. of bits to the right</li>
<li>Bit positions opened up by sihft are filled by least significant bit of source operand</li>
<li>Source operand is not affected</li>
<li>Syntax
<ul>
<li><code>SHRD destionation, source, count</code></li>
</ul>
</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">11000001b</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bl</span>,<span class="hljs-number">00011101b</span>
<span class="hljs-keyword">shld</span> <span class="hljs-built_in">al</span>,<span class="hljs-built_in">bl</span>,<span class="hljs-number">1</span>        <span class="hljs-comment">;CF,al = 1 11100000b</span>
</div></code></pre>
<h2 id="shift-and-rotate-applications">Shift and Rotate Applications</h2>
<pre class="hljs"><code><div><span class="hljs-comment">;Binary Multiplication</span>
<span class="hljs-comment">;123 = 01111011b</span>
<span class="hljs-comment">;36 =  00100100b</span>
<span class="hljs-comment">;123 * 36</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">123</span>
<span class="hljs-keyword">shl</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">2</span>
<span class="hljs-keyword">shl</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">5</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">;Isolate bit string</span>
<span class="hljs-comment">;MS-DOS file date field packs year month day into 16 bits</span>
<span class="hljs-comment">;day    = bit 0 to bit 4</span>
<span class="hljs-comment">;month  = bit 5 to bit 8</span>
<span class="hljs-comment">;year   = bit 9 to bit 15 </span>

<span class="hljs-comment">;Isolate month field which is stored in dx</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">dx</span>
<span class="hljs-keyword">shr</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">5</span>          <span class="hljs-comment">;mov month to beginning of ax</span>
<span class="hljs-keyword">and</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">00001111b</span>  <span class="hljs-comment">;clear bits 4-7</span>
<span class="hljs-keyword">mov</span> month,<span class="hljs-built_in">al</span>      <span class="hljs-comment">;save month in variable</span>
</div></code></pre>
<h2 id="multiplication-and-division-instructions">Multiplication and division instructions</h2>
<h3 id="mul-instruction">MUL Instruction</h3>
<ul>
<li>MUL(Unsigned multiply) instruction multiplies an 8,16,32 bit operand by AL,AX,EAX</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">Multiplicand</th>
<th style="text-align:center">Multiplier</th>
<th style="text-align:center">Product</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AL</td>
<td style="text-align:center">reg/mem8</td>
<td style="text-align:center">AX</td>
</tr>
<tr>
<td style="text-align:center">AX</td>
<td style="text-align:center">reg/mem16</td>
<td style="text-align:center">DX:AX</td>
</tr>
<tr>
<td style="text-align:center">EAX</td>
<td style="text-align:center">reg/mem32</td>
<td style="text-align:center">EDX:EAX</td>
</tr>
</tbody>
</table>
<p>DX:AX refers to upper half is stored in DX and lower half is in AX.
When this occurs <em>Carry flag</em> is set</p>
<pre class="hljs"><code><div><span class="hljs-comment">;100h * 2000h using 16 bit operands</span>
<span class="hljs-meta">.data</span>
val1 <span class="hljs-built_in">WORD</span> <span class="hljs-number">2000h</span>
val2 <span class="hljs-built_in">WORD</span> <span class="hljs-number">100h</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,val1
<span class="hljs-keyword">mul</span> val2        <span class="hljs-comment">;DX:AX = 00200000h, CF = 1</span>

<span class="hljs-comment">;12345h * 1000h using 32 bit operands</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-number">12345h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ebx</span>,<span class="hljs-number">1000h</span>
<span class="hljs-keyword">mul</span> <span class="hljs-built_in">ebx</span>           <span class="hljs-comment">;EDX:EAX = 0000000012345000h, CF = 0</span>
</div></code></pre>
<h3 id="imul-instruction">IMUL Instruction</h3>
<ul>
<li>IMUL(Signed Integer Multiply) multiplies 8,16,32 bit signed uperand by AL,AX,EAX</li>
<li>Preserves the sign of product by sign-extending it into upper half of destionation register</li>
</ul>
<p>Overflow Flag is set when sign extention <em>does not</em> occur</p>
<pre class="hljs"><code><div><span class="hljs-comment">;multiply 48*4 using 8-bit operands</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">48</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bl</span>,<span class="hljs-number">4</span>
<span class="hljs-keyword">imul</span> <span class="hljs-built_in">bl</span>       <span class="hljs-comment">;AX = 00C0h, OF=1</span>
</div></code></pre>
<h3 id="div-instruction">DIV Instruction</h3>
<ul>
<li>DIV(Unsigned Divide) instruction performs 8,16,32 bit division on unsigned integers</li>
<li>Single operand is supplied, which is assumed to be the divisor</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">Diveident</th>
<th style="text-align:center">Divisor</th>
<th style="text-align:center">Quotient</th>
<th style="text-align:center">Remainder</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AX</td>
<td style="text-align:center">reg/mem8</td>
<td style="text-align:center">AL</td>
<td style="text-align:center">AH</td>
</tr>
<tr>
<td style="text-align:center">DX:AX</td>
<td style="text-align:center">reg/mem16</td>
<td style="text-align:center">AX</td>
<td style="text-align:center">DX</td>
</tr>
<tr>
<td style="text-align:center">EDX:EAX</td>
<td style="text-align:center">reg/mem32</td>
<td style="text-align:center">EAX</td>
<td style="text-align:center">EDX</td>
</tr>
</tbody>
</table>
<pre class="hljs"><code><div><span class="hljs-comment">;Divide 8003h by 100h using 16 bit operands</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dx</span>,<span class="hljs-number">0</span>        <span class="hljs-comment">;clear divident, high</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">8003h</span>    <span class="hljs-comment">;set divident,   low</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">cx</span>,<span class="hljs-number">100h</span>     <span class="hljs-comment">;divisor</span>
<span class="hljs-keyword">div</span> <span class="hljs-built_in">cx</span>          <span class="hljs-comment">;ax = 0080h, dx = 3, ax is quotient, dx is remainder</span>

<span class="hljs-comment">;Same as above, but using 32 bit operands</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">edx</span>,<span class="hljs-number">9</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,<span class="hljs-number">8003h</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ecx</span>,<span class="hljs-number">100h</span>
<span class="hljs-keyword">div</span> <span class="hljs-built_in">ecx</span>
</div></code></pre>
<h3 id="signed-integer-division-idiv">Signed Integer Division (IDIV)</h3>
<ul>
<li>Signed integers must be sign extended before division takes place
<ul>
<li>Fill high byte/word/doubleword with copy of low b/w/dw sign bit</li>
</ul>
</li>
<li>EG: high byte contains copy of sign bit from low byte</li>
</ul>
<h3 id="cbw--cwd--cdq-instruction">CBW, CWD, CDQ Instruction</h3>
<p>Before we do sign division, we need the help of these instructions</p>
<ul>
<li>CBW, CWD, CDQ instructionr provide important sign-extension operations
<ul>
<li>CBW (convert byte to word) extends AL into AH</li>
<li>CWD (convert word to doubleword) extends AX into DX</li>
<li>CDQ (convert doubleword to quadword) extends EAX to EDX</li>
</ul>
</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-meta">.data</span>
dwordVal SDWORD -<span class="hljs-number">101</span>    <span class="hljs-comment">;FFFFFF9Bh</span>
<span class="hljs-meta">.code</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>,dWordVal
<span class="hljs-keyword">cdq</span>                     <span class="hljs-comment">;EDX:EAX = FFFFFFFFFFFFFF9Bh</span>
</div></code></pre>
<h3 id="idiv-instruction">IDIV Instruction</h3>
<ul>
<li>IDIV (Signed Divide) performs signed integer division</li>
<li>Same syntax and operands as DIV</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment">;8 bit division of -48 by 5</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,-<span class="hljs-number">48</span>
<span class="hljs-keyword">cbw</span>         <span class="hljs-comment">;extend AL into AH</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bl</span>,<span class="hljs-number">5</span>    <span class="hljs-comment">;divident</span>
<span class="hljs-keyword">idiv</span> <span class="hljs-built_in">bl</span>     <span class="hljs-comment">;AL = -9, AH = -3</span>

<span class="hljs-comment">;16 bit division of -48 by 5</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,-<span class="hljs-number">48</span>
<span class="hljs-keyword">cwd</span>         <span class="hljs-comment">;extend AX into DX</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>,<span class="hljs-number">5</span>    <span class="hljs-comment">;divident</span>
<span class="hljs-keyword">idiv</span> <span class="hljs-built_in">bx</span>     <span class="hljs-comment">;AX = -9, DX = -3</span>
</div></code></pre>

    </body>
    </html>